"use strict";const se=require("@codemirror/view"),G=require("@codemirror/state"),Oe=require("@codemirror/language"),Je=require("@codemirror/search"),we=require("@codemirror/commands"),Zt=require("markedit-api");function nn(f){const o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(f){for(const c in f)if(c!=="default"){const h=Object.getOwnPropertyDescriptor(f,c);Object.defineProperty(o,c,h.get?h:{enumerable:!0,get:()=>f[c]})}}return o.default=f,Object.freeze(o)}const an=nn(se);function on(f){var o=f.Pos;function c(e,t,r){if(t.line===r.line&&t.ch>=r.ch-1){var n=e.getLine(t.line),i=n.charCodeAt(t.ch);55296<=i&&i<=55551&&(r.ch+=1)}return{start:t,end:r}}var h=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"g<Up>",type:"keyToKey",toKeys:"gk"},{keys:"g<Down>",type:"keyToKey",toKeys:"gj"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h"},{keys:"<Del>",type:"keyToKey",toKeys:"x"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"g$",type:"motion",motion:"moveToEndOfDisplayLine"},{keys:"g^",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"g0",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<register>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<register>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!0}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!1}},{keys:"gq",type:"operator",operator:"hardWrap"},{keys:"gw",type:"operator",operator:"hardWrap",operatorArgs:{keepCursor:!0}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<register>",type:"action",action:"replayMacro"},{keys:"q<register>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<register>",type:"action",action:"setMark"},{keys:'"<register>',type:"action",action:"setRegister"},{keys:"<C-r><register>",type:"action",action:"insertRegister",context:"insert",isEdit:!0},{keys:"<C-o>",type:"action",action:"oneNormalCommand",context:"insert"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<register>",type:"motion",motion:"textObjectManipulation"},{keys:"i<register>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],y=h.length,k=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"omap",shortName:"om"},{name:"noremap",shortName:"no"},{name:"nnoremap",shortName:"nn"},{name:"vnoremap",shortName:"vn"},{name:"inoremap",shortName:"ino"},{name:"onoremap",shortName:"ono"},{name:"unmap"},{name:"mapclear",shortName:"mapc"},{name:"nmapclear",shortName:"nmapc"},{name:"vmapclear",shortName:"vmapc"},{name:"imapclear",shortName:"imapc"},{name:"omapclear",shortName:"omapc"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"startinsert",shortName:"start"},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"vglobal",shortName:"v"},{name:"delete",shortName:"d"},{name:"join",shortName:"j"},{name:"normal",shortName:"norm"},{name:"global",shortName:"g"}],x=gt("");function M(e){e.setOption("disableInput",!0),e.setOption("showCursorWhenSelecting",!1),f.signal(e,"vim-mode-change",{mode:"normal"}),e.on("cursorActivity",jt),Pe(e),f.on(e.getInputField(),"paste",K(e))}function L(e){e.setOption("disableInput",!1),e.off("cursorActivity",jt),f.off(e.getInputField(),"paste",K(e)),e.state.vim=null,Qe&&clearTimeout(Qe)}function K(e){var t=e.state.vim;return t.onPasteFn||(t.onPasteFn=function(){t.insertMode||(e.setCursor(J(e.getCursor(),0,1)),_e.enterInsertMode(e,{},t))}),t.onPasteFn}var F=/[\d]/,I=[f.isWordChar,function(e){return e&&!f.isWordChar(e)&&!/\s/.test(e)}],O=[function(e){return/\S/.test(e)}],V=["<",">"],P=["-",'"',".",":","_","/","+"],U=/^\w$/,W;try{W=new RegExp("^[\\p{Lu}]$","u")}catch{W=/^[A-Z]$/}function le(e,t){return t>=e.firstLine()&&t<=e.lastLine()}function ie(e){return/^[a-z]$/.test(e)}function Be(e){return"()[]{}".indexOf(e)!=-1}function Se(e){return F.test(e)}function ue(e){return W.test(e)}function j(e){return/^\s*$/.test(e)}function pe(e){return".?!".indexOf(e)!=-1}function Xe(e,t){for(var r=0;r<t.length;r++)if(t[r]==e)return!0;return!1}var xe={};function Ne(e,t,r,n,i){if(t===void 0&&!i)throw Error("defaultValue is required unless callback is provided");if(r||(r="string"),xe[e]={type:r,defaultValue:t,callback:i},n)for(var a=0;a<n.length;a++)xe[n[a]]=xe[e];t&&Ze(e,t)}function Ze(e,t,r,n){var i=xe[e];n=n||{};var a=n.scope;if(!i)return new Error("Unknown option: "+e);if(i.type=="boolean"){if(t&&t!==!0)return new Error("Invalid argument: "+e+"="+t);t!==!1&&(t=!0)}i.callback?(a!=="local"&&i.callback(t,void 0),a!=="global"&&r&&i.callback(t,r)):(a!=="local"&&(i.value=i.type=="boolean"?!!t:t),a!=="global"&&r&&(r.state.vim.options[e]={value:t}))}function Le(e,t,r){var n=xe[e];r=r||{};var i=r.scope;if(!n)return new Error("Unknown option: "+e);if(n.callback){let a=t&&n.callback(void 0,t);return i!=="global"&&a!==void 0?a:i!=="local"?n.callback():void 0}else return(i!=="global"&&t&&t.state.vim.options[e]||i!=="local"&&n||{}).value}Ne("filetype",void 0,"string",["ft"],function(e,t){if(t!==void 0)if(e===void 0){let r=t.getOption("mode");return r=="null"?"":r}else{let r=e==""?"null":e;t.setOption("mode",r)}}),Ne("textwidth",80,"number",["tw"],function(e,t){if(t!==void 0)if(e===void 0){var r=t.getOption("textwidth");return r}else{var n=Math.round(e);n>1&&t.setOption("textwidth",n)}});var sr=function(){var e=100,t=-1,r=0,n=0,i=new Array(e);function a(u,d,v){var m=t%e,C=i[m];function g(w){var S=++t%e,E=i[S];E&&E.clear(),i[S]=u.setBookmark(w)}if(C){var p=C.find();p&&!ce(p,d)&&g(d)}else g(d);g(v),r=t,n=t-e+1,n<0&&(n=0)}function s(u,d){t+=d,t>r?t=r:t<n&&(t=n);var v=i[(e+t)%e];if(v&&!v.find()){var m=d>0?1:-1,C,g=u.getCursor();do if(t+=m,v=i[(e+t)%e],v&&(C=v.find())&&!ce(g,C))break;while(t<r&&t>n)}return v}function l(u,d){var v=t,m=s(u,d);return t=v,m&&m.find()}return{cachedCursor:void 0,add:a,find:l,move:s}},dt=function(e){return e?{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};class lr{constructor(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=dt()}exitMacroRecordMode(){var t=b.macroModeState;t.onRecordingDone&&t.onRecordingDone(),t.onRecordingDone=void 0,t.isRecording=!1}enterMacroRecordMode(t,r){var n=b.registerController.getRegister(r);if(n){if(n.clear(),this.latestRegister=r,t.openDialog){var i=Ee("span",{class:"cm-vim-message"},"recording @"+r);this.onRecordingDone=t.openDialog(i,null,{bottom:!0})}this.isRecording=!0}}}function Pe(e){return e.state.vim||(e.state.vim={inputState:new yt,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeReturn:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{},expectLiteralNext:!1}),e.state.vim}var b;function vt(){b={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:sr(),macroModeState:new lr,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new dr({}),searchHistoryController:new mt,exCommandHistoryController:new mt};for(var e in xe){var t=xe[e];t.value=t.defaultValue}}var He,fe={enterVimMode:M,leaveVimMode:L,buildKeyMap:function(){},getRegisterController:function(){return b.registerController},resetVimGlobalState_:vt,getVimGlobalState_:function(){return b},maybeInitVimState_:Pe,suppressErrorLogging:!1,InsertModeKey:st,map:function(e,t,r){ve.map(e,t,r)},unmap:function(e,t){return ve.unmap(e,t)},noremap:function(e,t,r){ve.map(e,t,r,!0)},mapclear:function(e){var t=h.length,r=y,n=h.slice(0,t-r);if(h=h.slice(t-r),e)for(var i=n.length-1;i>=0;i--){var a=n[i];if(e!==a.context)if(a.context)this._mapCommand(a);else{var s=["normal","insert","visual"];for(var l in s)if(s[l]!==e){var u=Object.assign({},a);u.context=s[l],this._mapCommand(u)}}}},langmap:pt,vimKeyFromEvent:je,setOption:Ze,getOption:Le,defineOption:Ne,defineEx:function(e,t,r){if(!t)t=e;else if(e.indexOf(t)!==0)throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered');Ht[e]=r,ve.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e,t,r){var n=this.findKey(e,t,r);if(typeof n=="function")return n()},multiSelectHandleKey:tn,findKey:function(e,t,r){var n=Pe(e),i=e;function a(){var v=b.macroModeState;if(v.isRecording){if(t=="q")return v.exitMacroRecordMode(),X(i),!0;r!="mapping"&&Zr(v,t)}}function s(){if(t=="<Esc>"){if(n.visualMode)ye(i);else if(n.insertMode)Ae(i);else return;return X(i),!0}}function l(){if(s())return!0;n.inputState.keyBuffer.push(t);var v=n.inputState.keyBuffer.join(""),m=t.length==1,C=Re.matchCommand(v,h,n.inputState,"insert"),g=n.inputState.changeQueue;if(C.type=="none")return X(i),!1;if(C.type=="partial"){if(C.expectLiteralNext&&(n.expectLiteralNext=!0),He&&window.clearTimeout(He),He=m&&window.setTimeout(function(){n.insertMode&&n.inputState.keyBuffer.length&&X(i)},Le("insertModeEscKeysTimeout")),m){var p=i.listSelections();(!g||g.removed.length!=p.length)&&(g=n.inputState.changeQueue=new cr),g.inserted+=t;for(var w=0;w<p.length;w++){var S=ae(p[w].anchor,p[w].head),E=Te(p[w].anchor,p[w].head),T=i.getRange(S,i.state.overwrite?J(E,0,1):E);g.removed[w]=(g.removed[w]||"")+T}}return!m}if(n.expectLiteralNext=!1,He&&window.clearTimeout(He),C.command&&g){for(var p=i.listSelections(),w=0;w<p.length;w++){var A=p[w].head;i.replaceRange(g.removed[w]||"",J(A,0,-g.inserted.length),A,"+input")}b.macroModeState.lastInsertModeChanges.changes.pop()}return C.command||X(i),C.command}function u(){if(a()||s())return!0;n.inputState.keyBuffer.push(t);var v=n.inputState.keyBuffer.join("");if(/^[1-9]\d*$/.test(v))return!0;var m=/^(\d*)(.*)$/.exec(v);if(!m)return X(i),!1;var C=n.visualMode?"visual":"normal",g=m[2]||m[1];n.inputState.operatorShortcut&&n.inputState.operatorShortcut.slice(-1)==g&&(g=n.inputState.operatorShortcut);var p=Re.matchCommand(g,h,n.inputState,C);return p.type=="none"?(X(i),!1):p.type=="partial"?(p.expectLiteralNext&&(n.expectLiteralNext=!0),!0):p.type=="clear"?(X(i),!0):(n.expectLiteralNext=!1,n.inputState.keyBuffer.length=0,m=/^(\d*)(.*)$/.exec(v),m&&m[1]&&m[1]!="0"&&n.inputState.pushRepeatDigit(m[1]),p.command)}var d;return n.insertMode?d=l():d=u(),d===!1?!n.insertMode&&t.length===1?function(){return!0}:void 0:d===!0?function(){return!0}:function(){return i.operation(function(){i.curOp.isVimOp=!0;try{d.type=="keyToKey"?We(i,d.toKeys,d):Re.processCommand(i,n,d)}catch(v){throw i.state.vim=void 0,Pe(i),fe.suppressErrorLogging||console.log(v),v}return!0})}},handleEx:function(e,t){ve.processCommand(e,t)},defineMotion:vr,defineAction:gr,defineOperator:pr,mapCommand:Gr,_mapCommand:Vt,defineRegister:hr,exitVisualMode:ye,exitInsertMode:Ae},Ke=[],Ve=!1,Q;function ur(e){if(e[0]=="<"){var t=e.toLowerCase().slice(1,-1),r=t.split("-");if(t=r.pop()||"",t=="lt")e="<";else if(t=="space")e=" ";else if(t=="cr")e=`
`;else if(De[t]){var n=Q.value,i={key:De[t],target:{value:n,selectionEnd:n.length,selectionStart:n.length}};Q.onKeyDown&&Q.onKeyDown(i,Q.value,s),Q&&Q.onKeyUp&&Q.onKeyUp(i,Q.value,s);return}}if(e==`
`){var a=Q;Q=null,a.onClose&&a.onClose(a.value)}else Q.value=(Q.value||"")+e;function s(l){typeof l=="string"?Q.value=l:Q=null}}function We(e,t,r){var n=Ve;if(r){if(Ke.indexOf(r)!=-1)return;Ke.push(r),Ve=r.noremap!=!1}try{for(var i=Pe(e),a=/<(?:[CSMA]-)*\w+>|./gi,s;s=a.exec(t);){var l=s[0],u=i.insertMode;if(Q){ur(l);continue}var d=fe.handleKey(e,l,"mapping");if(!d&&u&&i.insertMode){if(l[0]=="<"){var v=l.toLowerCase().slice(1,-1),m=v.split("-");if(v=m.pop()||"",v=="lt")l="<";else if(v=="space")l=" ";else if(v=="cr")l=`
`;else if(De.hasOwnProperty(v)){l=De[v],Jt(e,l);continue}else l=l[0],a.lastIndex=s.index+1}e.replaceSelection(l)}}}finally{if(Ke.pop(),Ve=Ke.length?n:!1,!Ke.length&&Q){var C=Q;Q=null,$e(e,C)}}}var Ye={Return:"CR",Backspace:"BS",Delete:"Del",Escape:"Esc",Insert:"Ins",ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Up",ArrowDown:"Down",Enter:"CR"," ":"Space"},fr={Shift:1,Alt:1,Command:1,Control:1,CapsLock:1,AltGraph:1,Dead:1,Unidentified:1},De={};"Left|Right|Up|Down|End|Home".split("|").concat(Object.keys(Ye)).forEach(function(e){De[(Ye[e]||"").toLowerCase()]=De[e.toLowerCase()]=e});function je(e,t){var a;var r=e.key;if(!fr[r]){r.length>1&&r[0]=="n"&&(r=r.replace("Numpad","")),r=Ye[r]||r;var n="";if(e.ctrlKey&&(n+="C-"),e.altKey&&(n+="A-"),e.metaKey&&(n+="M-"),f.isMac&&e.altKey&&!e.metaKey&&!e.ctrlKey&&(n=n.slice(2)),(n||r.length>1)&&e.shiftKey&&(n+="S-"),t&&!t.expectLiteralNext&&r.length==1){if(x.keymap&&r in x.keymap)(x.remapCtrl!=!1||!n)&&(r=x.keymap[r]);else if(r.charCodeAt(0)>255){var i=((a=e.code)==null?void 0:a.slice(-1))||"";e.shiftKey||(i=i.toLowerCase()),i&&(r=i)}}return n+=r,n.length>1&&(n="<"+n+">"),n}}function pt(e,t){x.string!==e&&(x=gt(e)),x.remapCtrl=t}function gt(e){let t={};if(!e)return{keymap:t,string:""};function r(n){return n.split(/\\?(.)/).filter(Boolean)}return e.split(/((?:[^\\,]|\\.)+),/).map(n=>{if(!n)return;const i=n.split(/((?:[^\\;]|\\.)+);/);if(i.length==3){const a=r(i[1]),s=r(i[2]);if(a.length!==s.length)return;for(let l=0;l<a.length;++l)t[a[l]]=s[l]}else if(i.length==1){const a=r(n);if(a.length%2!==0)return;for(let s=0;s<a.length;s+=2)t[a[s]]=a[s+1]}}),{keymap:t,string:e}}Ne("langmap",void 0,"string",["lmap"],function(e,t){if(e===void 0)return x.string;pt(e)});class yt{constructor(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null,this.changeQueue=null}pushRepeatDigit(t){this.operator?this.motionRepeat=this.motionRepeat.concat(t):this.prefixRepeat=this.prefixRepeat.concat(t)}getRepeat(){var t=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(t=1,this.prefixRepeat.length>0&&(t*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(t*=parseInt(this.motionRepeat.join(""),10))),t}}function X(e,t){e.state.vim.inputState=new yt,e.state.vim.expectLiteralNext=!1,f.signal(e,"vim-command-done",t)}function cr(){this.removed=[],this.inserted=""}class ge{constructor(t,r,n){this.clear(),this.keyBuffer=[t||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!r,this.blockwise=!!n}setText(t,r,n){this.keyBuffer=[t||""],this.linewise=!!r,this.blockwise=!!n}pushText(t,r){r&&(this.linewise||this.keyBuffer.push(`
`),this.linewise=!0),this.keyBuffer.push(t)}pushInsertModeChanges(t){this.insertModeChanges.push(dt(t))}pushSearchQuery(t){this.searchQueries.push(t)}clear(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1}toString(){return this.keyBuffer.join("")}}function hr(e,t){var r=b.registerController.registers;if(!e||e.length!=1)throw Error("Register name must be 1 character");if(r[e])throw Error("Register already defined "+e);r[e]=t,P.push(e)}class dr{constructor(t){this.registers=t,this.unnamedRegister=t['"']=new ge,t["."]=new ge,t[":"]=new ge,t["/"]=new ge,t["+"]=new ge}pushText(t,r,n,i,a){if(t!=="_"){i&&n.charAt(n.length-1)!==`
`&&(n+=`
`);var s=this.isValidRegister(t)?this.getRegister(t):null;if(!s){switch(r){case"yank":this.registers[0]=new ge(n,i,a);break;case"delete":case"change":n.indexOf(`
`)==-1?this.registers["-"]=new ge(n,i):(this.shiftNumericRegisters_(),this.registers[1]=new ge(n,i));break}this.unnamedRegister.setText(n,i,a);return}var l=ue(t);l?s.pushText(n,i):s.setText(n,i,a),t==="+"&&navigator.clipboard.writeText(n),this.unnamedRegister.setText(s.toString(),i)}}getRegister(t){return this.isValidRegister(t)?(t=t.toLowerCase(),this.registers[t]||(this.registers[t]=new ge),this.registers[t]):this.unnamedRegister}isValidRegister(t){return t&&(Xe(t,P)||U.test(t))}shiftNumericRegisters_(){for(var t=9;t>=2;t--)this.registers[t]=this.getRegister(""+(t-1))}}class mt{constructor(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}nextMatch(t,r){var n=this.historyBuffer,i=r?-1:1;this.initialPrefix===null&&(this.initialPrefix=t);for(var a=this.iterator+i;r?a>=0:a<n.length;a+=i)for(var s=n[a],l=0;l<=s.length;l++)if(this.initialPrefix==s.substring(0,l))return this.iterator=a,s;if(a>=n.length)return this.iterator=n.length,this.initialPrefix;if(a<0)return t}pushInput(t){var r=this.historyBuffer.indexOf(t);r>-1&&this.historyBuffer.splice(r,1),t.length&&this.historyBuffer.push(t)}reset(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}}var Re={matchCommand:function(e,t,r,n){var i=yr(e,t,n,r);if(!i.full&&!i.partial)return{type:"none"};if(!i.full&&i.partial)return{type:"partial",expectLiteralNext:i.partial.length==1&&i.partial[0].keys.slice(-11)=="<character>"};for(var a,s=0;s<i.full.length;s++){var l=i.full[s];a||(a=l)}if(a.keys.slice(-11)=="<character>"||a.keys.slice(-10)=="<register>"){var u=Cr(e);if(!u||u.length>1)return{type:"clear"};r.selectedCharacter=u}return{type:"full",command:a}},processCommand:function(e,t,r){switch(t.inputState.repeatOverride=r.repeatOverride,r.type){case"motion":this.processMotion(e,t,r);break;case"operator":this.processOperator(e,t,r);break;case"operatorMotion":this.processOperatorMotion(e,t,r);break;case"action":this.processAction(e,t,r);break;case"search":this.processSearch(e,t,r);break;case"ex":case"keyToEx":this.processEx(e,t,r);break}},processMotion:function(e,t,r){t.inputState.motion=r.motion,t.inputState.motionArgs=ze(r.motionArgs),this.evalInput(e,t)},processOperator:function(e,t,r){var n=t.inputState;if(n.operator)if(n.operator==r.operator){n.motion="expandToLine",n.motionArgs={linewise:!0,repeat:1},this.evalInput(e,t);return}else X(e);n.operator=r.operator,n.operatorArgs=ze(r.operatorArgs),r.keys.length>1&&(n.operatorShortcut=r.keys),r.exitVisualBlock&&(t.visualBlock=!1,Fe(e)),t.visualMode&&this.evalInput(e,t)},processOperatorMotion:function(e,t,r){var n=t.visualMode,i=ze(r.operatorMotionArgs);i&&n&&i.visualLine&&(t.visualLine=!0),this.processOperator(e,t,r),n||this.processMotion(e,t,r)},processAction:function(e,t,r){var n=t.inputState,i=n.getRepeat(),a=!!i,s=ze(r.actionArgs)||{repeat:1};n.selectedCharacter&&(s.selectedCharacter=n.selectedCharacter),r.operator&&this.processOperator(e,t,r),r.motion&&this.processMotion(e,t,r),(r.motion||r.operator)&&this.evalInput(e,t),s.repeat=i||1,s.repeatIsExplicit=a,s.registerName=n.registerName,X(e),t.lastMotion=null,r.isEdit&&this.recordLastEdit(t,n,r),_e[r.action](e,s,t)},processSearch:function(e,t,r){if(!e.getSearchCursor)return;var n=r.searchArgs.forward,i=r.searchArgs.wholeWordOnly;de(e).setReversed(!n);var a=n?"/":"?",s=de(e).getQuery(),l=e.getScrollInfo();function u(w,S,E){b.searchHistoryController.pushInput(w),b.searchHistoryController.reset();try{Ue(e,w,S,E)}catch{D(e,"Invalid regex: "+w),X(e);return}Re.processMotion(e,t,{keys:"",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:r.searchArgs.toJumplist}})}function d(w){e.scrollTo(l.left,l.top),u(w,!0,!0);var S=b.macroModeState;S.isRecording&&en(S,w)}function v(w,S,E){var T=je(w),A,_;T=="<Up>"||T=="<Down>"?(A=T=="<Up>",_=w.target?w.target.selectionEnd:0,S=b.searchHistoryController.nextMatch(S,A)||"",E(S),_&&w.target&&(w.target.selectionEnd=w.target.selectionStart=Math.min(_,w.target.value.length))):T&&T!="<Left>"&&T!="<Right>"&&b.searchHistoryController.reset();var te;try{te=Ue(e,S,!0,!0)}catch{}te?e.scrollIntoView(_t(e,!n,te),30):(at(e),e.scrollTo(l.left,l.top))}function m(w,S,E){var T=je(w);T=="<Esc>"||T=="<C-c>"||T=="<C-[>"||T=="<BS>"&&S==""?(b.searchHistoryController.pushInput(S),b.searchHistoryController.reset(),Ue(e,s),at(e),e.scrollTo(l.left,l.top),f.e_stop(w),X(e),E(),e.focus()):T=="<Up>"||T=="<Down>"?f.e_stop(w):T=="<C-u>"&&(f.e_stop(w),E(""))}switch(r.searchArgs.querySrc){case"prompt":var C=b.macroModeState;if(C.isPlaying){let S=C.replaySearchQueries.shift();u(S,!0,!1)}else $e(e,{onClose:d,prefix:a,desc:"(JavaScript regexp)",onKeyUp:v,onKeyDown:m});break;case"wordUnderCursor":var g=nt(e,{noSymbol:!0}),p=!0;if(g||(g=nt(e,{noSymbol:!1}),p=!1),!g){D(e,"No word under cursor"),X(e);return}let w=e.getLine(g.start.line).substring(g.start.ch,g.end.ch);p&&i?w="\\b"+w+"\\b":w=kr(w),b.jumpList.cachedCursor=e.getCursor(),e.setCursor(g.start),u(w,!0,!1);break}},processEx:function(e,t,r){function n(a){b.exCommandHistoryController.pushInput(a),b.exCommandHistoryController.reset(),ve.processCommand(e,a),e.state.vim&&X(e)}function i(a,s,l){var u=je(a),d,v;(u=="<Esc>"||u=="<C-c>"||u=="<C-[>"||u=="<BS>"&&s=="")&&(b.exCommandHistoryController.pushInput(s),b.exCommandHistoryController.reset(),f.e_stop(a),X(e),l(),e.focus()),u=="<Up>"||u=="<Down>"?(f.e_stop(a),d=u=="<Up>",v=a.target?a.target.selectionEnd:0,s=b.exCommandHistoryController.nextMatch(s,d)||"",l(s),v&&a.target&&(a.target.selectionEnd=a.target.selectionStart=Math.min(v,a.target.value.length))):u=="<C-u>"?(f.e_stop(a),l("")):u&&u!="<Left>"&&u!="<Right>"&&b.exCommandHistoryController.reset()}r.type=="keyToEx"?ve.processCommand(e,r.exArgs.input):t.visualMode?$e(e,{onClose:n,prefix:":",value:"'<,'>",onKeyDown:i,selectValueOnOpen:!1}):$e(e,{onClose:n,prefix:":",onKeyDown:i})},evalInput:function(e,t){var r=t.inputState,n=r.motion,i=r.motionArgs||{repeat:1},a=r.operator,s=r.operatorArgs||{},l=r.registerName,u=t.sel,d=H(t.visualMode?re(e,u.head):e.getCursor("head")),v=H(t.visualMode?re(e,u.anchor):e.getCursor("anchor")),m=H(d),C=H(v),g,p,w;if(a&&this.recordLastEdit(t,r),r.repeatOverride!==void 0?w=r.repeatOverride:w=r.getRepeat(),w>0&&i.explicitRepeat?i.repeatIsExplicit=!0:(i.noRepeat||!i.explicitRepeat&&w===0)&&(w=1,i.repeatIsExplicit=!1),r.selectedCharacter&&(i.selectedCharacter=s.selectedCharacter=r.selectedCharacter),i.repeat=w,X(e),n){var S=Me[n](e,d,i,t,r);if(t.lastMotion=Me[n],!S)return;if(i.toJumplist){var E=b.jumpList,T=E.cachedCursor;T?(bt(e,T,S),delete E.cachedCursor):bt(e,d,S)}S instanceof Array?(p=S[0],g=S[1]):g=S,g||(g=H(d)),t.visualMode?(t.visualBlock&&g.ch===1/0||(g=re(e,g,m)),p&&(p=re(e,p)),p=p||C,u.anchor=p,u.head=g,Fe(e),be(e,t,"<",$(p,g)?p:g),be(e,t,">",$(p,g)?g:p)):a||(g=re(e,g,m),e.setCursor(g.line,g.ch))}if(a){if(s.lastSel){p=C;var A=s.lastSel,_=Math.abs(A.head.line-A.anchor.line),te=Math.abs(A.head.ch-A.anchor.ch);A.visualLine?g=new o(C.line+_,C.ch):A.visualBlock?g=new o(C.line+_,C.ch+te):A.head.line==A.anchor.line?g=new o(C.line,C.ch+te):g=new o(C.line+_,C.ch),t.visualMode=!0,t.visualLine=A.visualLine,t.visualBlock=A.visualBlock,u=t.sel={anchor:p,head:g},Fe(e)}else t.visualMode&&(s.lastSel={anchor:H(u.anchor),head:H(u.head),visualBlock:t.visualBlock,visualLine:t.visualLine});var q,Y,B,N,ne;if(t.visualMode){q=ae(u.head,u.anchor),Y=Te(u.head,u.anchor),B=t.visualLine||s.linewise,N=t.visualBlock?"block":B?"line":"char";var ee=c(e,q,Y);if(ne=rt(e,{anchor:ee.start,head:ee.end},N),B){var z=ne.ranges;if(N=="block")for(var Ce=0;Ce<z.length;Ce++)z[Ce].head.ch=Z(e,z[Ce].head.line);else N=="line"&&(z[0].head=new o(z[0].head.line+1,0))}}else{if(q=H(p||C),Y=H(g||m),$(Y,q)){var ut=q;q=Y,Y=ut}B=i.linewise||s.linewise,B?Tr(e,q,Y):i.forward&&Lr(e,q,Y),N="char";var rn=!i.inclusive||B,ee=c(e,q,Y);ne=rt(e,{anchor:ee.start,head:ee.end},N,rn)}e.setSelections(ne.ranges,ne.primary),t.lastMotion=null,s.repeat=w,s.registerName=l,s.linewise=B;var ft=et[a](e,s,ne.ranges,C,g);t.visualMode&&ye(e,ft!=null),ft&&e.setCursor(ft)}},recordLastEdit:function(e,t,r){var n=b.macroModeState;n.isPlaying||(e.lastEditInputState=t,e.lastEditActionCommand=r,n.lastInsertModeChanges.changes=[],n.lastInsertModeChanges.expectCursorActivityForChange=!1,n.lastInsertModeChanges.visualBlock=e.visualBlock?e.sel.head.line-e.sel.anchor.line:0)}},Me={moveToTopLine:function(e,t,r){var n=ot(e).top+r.repeat-1;return new o(n,me(e.getLine(n)))},moveToMiddleLine:function(e){var t=ot(e),r=Math.floor((t.top+t.bottom)*.5);return new o(r,me(e.getLine(r)))},moveToBottomLine:function(e,t,r){var n=ot(e).bottom-r.repeat+1;return new o(n,me(e.getLine(n)))},expandToLine:function(e,t,r){var n=t;return new o(n.line+r.repeat-1,1/0)},findNext:function(e,t,r){var n=de(e),i=n.getQuery();if(i){var a=!r.forward;return a=n.isReversed()?!a:a,Dt(e,i),_t(e,a,i,r.repeat)}},findAndSelectNextInclusive:function(e,t,r,n,i){var a=de(e),s=a.getQuery();if(s){var l=!r.forward;l=a.isReversed()?!l:l;var u=Qr(e,l,s,r.repeat,n);if(u){if(i.operator)return u;var d=u[0],v=new o(u[1].line,u[1].ch-1);if(n.visualMode){(n.visualLine||n.visualBlock)&&(n.visualLine=!1,n.visualBlock=!1,f.signal(e,"vim-mode-change",{mode:"visual",subMode:""}));var m=n.sel.anchor;if(m)return a.isReversed()?r.forward?[m,d]:[m,v]:r.forward?[m,v]:[m,d]}else n.visualMode=!0,n.visualLine=!1,n.visualBlock=!1,f.signal(e,"vim-mode-change",{mode:"visual",subMode:""});return l?[v,d]:[d,v]}}},goToMark:function(e,t,r,n){var i=Ge(e,n,r.selectedCharacter||"");return i?r.linewise?{line:i.line,ch:me(e.getLine(i.line))}:i:null},moveToOtherHighlightedEnd:function(e,t,r,n){if(n.visualBlock&&r.sameLine){var i=n.sel;return[re(e,new o(i.anchor.line,i.head.ch)),re(e,new o(i.head.line,i.anchor.ch))]}else return[n.sel.head,n.sel.anchor]},jumpToMark:function(e,t,r,n){for(var i=t,a=0;a<r.repeat;a++){var s=i;for(var l in n.marks)if(ie(l)){var u=n.marks[l].find(),d=r.forward?$(u,s):$(s,u);if(!d&&!(r.linewise&&u.line==s.line)){var v=ce(s,i),m=r.forward?wt(s,u,i):wt(i,u,s);(v||m)&&(i=u)}}}return r.linewise&&(i=new o(i.line,me(e.getLine(i.line)))),i},moveByCharacters:function(e,t,r){var n=t,i=r.repeat,a=r.forward?n.ch+i:n.ch-i;return new o(n.line,a)},moveByLines:function(e,t,r,n){var i=t,a=i.ch;switch(n.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:a=n.lastHPos;break;default:n.lastHPos=a}var s=r.repeat+(r.repeatOffset||0),l=r.forward?i.line+s:i.line-s,u=e.firstLine(),d=e.lastLine(),v=e.findPosV(i,r.forward?s:-s,"line",n.lastHSPos),m=r.forward?v.line>l:v.line<l;return m&&(l=v.line,a=v.ch),l<u&&i.line==u?this.moveToStartOfLine(e,t,r,n):l>d&&i.line==d?At(e,t,r,n,!0):(r.toFirstChar&&(a=me(e.getLine(l)),n.lastHPos=a),n.lastHSPos=e.charCoords(new o(l,a),"div").left,new o(l,a))},moveByDisplayLines:function(e,t,r,n){var i=t;switch(n.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:n.lastHSPos=e.charCoords(i,"div").left}var a=r.repeat,s=e.findPosV(i,r.forward?a:-a,"line",n.lastHSPos);if(s.hitSide)if(r.forward){var l=e.charCoords(s,"div"),u={top:l.top+8,left:n.lastHSPos};s=e.coordsChar(u,"div")}else{var d=e.charCoords(new o(e.firstLine(),0),"div");d.left=n.lastHSPos,s=e.coordsChar(d,"div")}return n.lastHPos=s.ch,s},moveByPage:function(e,t,r){var n=t,i=r.repeat;return e.findPosV(n,r.forward?i:-i,"page")},moveByParagraph:function(e,t,r){var n=r.forward?1:-1;return Ot(e,t,r.repeat,n).start},moveBySentence:function(e,t,r){var n=r.forward?1:-1;return Nr(e,t,r.repeat,n)},moveByScroll:function(e,t,r,n){var i=e.getScrollInfo(),a=null,s=r.repeat;s||(s=i.clientHeight/(2*e.defaultTextHeight()));var l=e.charCoords(t,"local");if(r.repeat=s,a=Me.moveByDisplayLines(e,t,r,n),!a)return null;var u=e.charCoords(a,"local");return e.scrollTo(null,i.top+u.top-l.top),a},moveByWords:function(e,t,r){return Rr(e,t,r.repeat,!!r.forward,!!r.wordEnd,!!r.bigWord)},moveTillCharacter:function(e,t,r){var n=r.repeat,i=it(e,n,r.forward,r.selectedCharacter,t),a=r.forward?-1:1;return Lt(a,r),i?(i.ch+=a,i):null},moveToCharacter:function(e,t,r){var n=r.repeat;return Lt(0,r),it(e,n,r.forward,r.selectedCharacter,t)||t},moveToSymbol:function(e,t,r){var n=r.repeat;return r.selectedCharacter&&Or(e,n,r.forward,r.selectedCharacter)||t},moveToColumn:function(e,t,r,n){var i=r.repeat;return n.lastHPos=i-1,n.lastHSPos=e.charCoords(t,"div").left,Ir(e,i)},moveToEol:function(e,t,r,n){return At(e,t,r,n,!1)},moveToFirstNonWhiteSpaceCharacter:function(e,t){var r=t;return new o(r.line,me(e.getLine(r.line)))},moveToMatchedSymbol:function(e,t){for(var r=t,n=r.line,i=r.ch,a=e.getLine(n),s;i<a.length;i++)if(s=a.charAt(i),s&&Be(s)){var l=e.getTokenTypeAt(new o(n,i+1));if(l!=="string"&&l!=="comment")break}if(i<a.length){var u=s==="<"||s===">"?/[(){}[\]<>]/:/[(){}[\]]/,d=e.findMatchingBracket(new o(n,i),{bracketRegex:u});return d.to}else return r},moveToStartOfLine:function(e,t){return new o(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t,r){var n=r.forward?e.lastLine():e.firstLine();return r.repeatIsExplicit&&(n=r.repeat-e.getOption("firstLineNumber")),new o(n,me(e.getLine(n)))},moveToStartOfDisplayLine:function(e){return e.execCommand("goLineLeft"),e.getCursor()},moveToEndOfDisplayLine:function(e){e.execCommand("goLineRight");var t=e.getCursor();return t.sticky=="before"&&t.ch--,t},textObjectManipulation:function(e,t,r,n){var i={"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"},a={"'":!0,'"':!0,"`":!0},s=r.selectedCharacter||"";s=="b"?s="(":s=="B"&&(s="{");var l=!r.textObjectInner,u,d;if(i[s]){if(d=!0,u=It(e,t,s,l),!u){var v=e.getSearchCursor(new RegExp("\\"+s,"g"),t);v.find()&&(u=It(e,v.from(),s,l))}}else if(a[s])d=!0,u=Pr(e,t,s,l);else if(s==="W"||s==="w")for(var m=r.repeat||1;m-- >0;){var C=nt(e,{inclusive:l,innerWord:!l,bigWord:s==="W",noSymbol:s==="W",multiline:!0},u&&u.end);C&&(u||(u=C),u.end=C.end)}else if(s==="p")if(u=Ot(e,t,r.repeat,0,l),r.linewise=!0,n.visualMode)n.visualLine||(n.visualLine=!0);else{var g=n.inputState.operatorArgs;g&&(g.linewise=!0),u.end.line--}else if(s==="t")u=Er(e,t,l);else if(s==="s"){var p=e.getLine(t.line);t.ch>0&&pe(p[t.ch])&&(t.ch-=1);var w=Rt(e,t,r.repeat,1,l),S=Rt(e,t,r.repeat,-1,l);j(e.getLine(S.line)[S.ch])&&j(e.getLine(w.line)[w.ch-1])&&(S={line:S.line,ch:S.ch+1}),u={start:S,end:w}}return u?e.state.vim.visualMode?Mr(e,u.start,u.end,d):[u.start,u.end]:null},repeatLastCharacterSearch:function(e,t,r){var n=b.lastCharacterSearch,i=r.repeat,a=r.forward===n.forward,s=(n.increment?1:0)*(a?-1:1);e.moveH(-s,"char"),r.inclusive=!!a;var l=it(e,i,a,n.selectedCharacter);return l?(l.ch+=s,l):(e.moveH(s,"char"),t)}};function vr(e,t){Me[e]=t}function Ct(e,t){for(var r=[],n=0;n<t;n++)r.push(e);return r}var et={change:function(e,t,r){var n,i,a=e.state.vim,s=r[0].anchor,l=r[0].head;if(a.visualMode)if(t.fullLine)l.ch=Number.MAX_VALUE,l.line--,e.setSelection(s,l),i=e.getSelection(),e.replaceSelection(""),n=s;else{i=e.getSelection();var v=Ct("",r.length);e.replaceSelections(v),n=ae(r[0].head,r[0].anchor)}else{i=e.getRange(s,l);var u=a.lastEditInputState;if((u==null?void 0:u.motion)=="moveByWords"&&!j(i)){var d=/\s+$/.exec(i);d&&u.motionArgs&&u.motionArgs.forward&&(l=J(l,0,-d[0].length),i=i.slice(0,-d[0].length))}t.linewise&&(s=new o(s.line,me(e.getLine(s.line))),l.line>s.line&&(l=new o(l.line-1,Number.MAX_VALUE))),e.replaceRange("",s,l),n=s}b.registerController.pushText(t.registerName,"change",i,t.linewise,r.length>1),_e.enterInsertMode(e,{head:n},e.state.vim)},delete:function(e,t,r){var n,i,a=e.state.vim;if(a.visualBlock){i=e.getSelection();var u=Ct("",r.length);e.replaceSelections(u),n=ae(r[0].head,r[0].anchor)}else{var s=r[0].anchor,l=r[0].head;t.linewise&&l.line!=e.firstLine()&&s.line==e.lastLine()&&s.line==l.line-1&&(s.line==e.firstLine()?s.ch=0:s=new o(s.line-1,Z(e,s.line-1))),i=e.getRange(s,l),e.replaceRange("",s,l),n=s,t.linewise&&(n=Me.moveToFirstNonWhiteSpaceCharacter(e,s))}return b.registerController.pushText(t.registerName,"delete",i,t.linewise,a.visualBlock),re(e,n)},indent:function(e,t,r){var n=e.state.vim,i=n.visualMode?t.repeat||0:1;if(e.indentMore)for(var a=0;a<i;a++)t.indentRight?e.indentMore():e.indentLess();else{var s=r[0].anchor.line,l=n.visualBlock?r[r.length-1].anchor.line:r[0].head.line;t.linewise&&l--;for(var u=s;u<=l;u++)for(var a=0;a<i;a++)e.indentLine(u,t.indentRight)}return Me.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},indentAuto:function(e,t,r){return e.execCommand("indentAuto"),Me.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},hardWrap:function(e,t,r,n){if(e.hardWrap){var i=r[0].anchor.line,a=r[0].head.line;t.linewise&&a--;var s=e.hardWrap({from:i,to:a});return s>i&&t.linewise&&s--,t.keepCursor?n:new o(s,0)}},changeCase:function(e,t,r,n,i){for(var a=e.getSelections(),s=[],l=t.toLower,u=0;u<a.length;u++){var d=a[u],v="";if(l===!0)v=d.toLowerCase();else if(l===!1)v=d.toUpperCase();else for(var m=0;m<d.length;m++){var C=d.charAt(m);v+=ue(C)?C.toLowerCase():C.toUpperCase()}s.push(v)}return e.replaceSelections(s),t.shouldMoveCursor?i:!e.state.vim.visualMode&&t.linewise&&r[0].anchor.line+1==r[0].head.line?Me.moveToFirstNonWhiteSpaceCharacter(e,n):t.linewise?n:ae(r[0].anchor,r[0].head)},yank:function(e,t,r,n){var i=e.state.vim,a=e.getSelection(),s=i.visualMode?ae(i.sel.anchor,i.sel.head,r[0].head,r[0].anchor):n;return b.registerController.pushText(t.registerName,"yank",a,t.linewise,i.visualBlock),s}};function pr(e,t){et[e]=t}var _e={jumpListWalk:function(e,t,r){if(!r.visualMode){var n=t.repeat||1,i=t.forward,a=b.jumpList,s=a.move(e,i?n:-n),l=s?s.find():void 0;l=l||e.getCursor(),e.setCursor(l)}},scroll:function(e,t,r){if(!r.visualMode){var n=t.repeat||1,i=e.defaultTextHeight(),a=e.getScrollInfo().top,s=i*n,l=t.forward?a+s:a-s,u=H(e.getCursor()),d=e.charCoords(u,"local");if(t.forward)l>d.top?(u.line+=(l-d.top)/i,u.line=Math.ceil(u.line),e.setCursor(u),d=e.charCoords(u,"local"),e.scrollTo(null,d.top)):e.scrollTo(null,l);else{var v=l+e.getScrollInfo().clientHeight;v<d.bottom?(u.line-=(d.bottom-v)/i,u.line=Math.floor(u.line),e.setCursor(u),d=e.charCoords(u,"local"),e.scrollTo(null,d.bottom-e.getScrollInfo().clientHeight)):e.scrollTo(null,l)}}},scrollToCursor:function(e,t){var r=e.getCursor().line,n=e.charCoords(new o(r,0),"local"),i=e.getScrollInfo().clientHeight,a=n.top;switch(t.position){case"center":a=n.bottom-i/2;break;case"bottom":var s=new o(r,e.getLine(r).length-1),l=e.charCoords(s,"local"),u=l.bottom-a;a=a-i+u;break}e.scrollTo(null,a)},replayMacro:function(e,t,r){var n=t.selectedCharacter||"",i=t.repeat||1,a=b.macroModeState;for(n=="@"?n=a.latestRegister:a.latestRegister=n;i--;)Xr(e,r,a,n)},enterMacroRecordMode:function(e,t){var r=b.macroModeState,n=t.selectedCharacter;b.registerController.isValidRegister(n)&&r.enterMacroRecordMode(e,n)},toggleOverwrite:function(e){e.state.overwrite?(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),f.signal(e,"vim-mode-change",{mode:"insert"})):(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),f.signal(e,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(e,t,r){if(!e.getOption("readOnly")){r.insertMode=!0,r.insertModeRepeat=t&&t.repeat||1;var n=t?t.insertAt:null,i=r.sel,a=t.head||e.getCursor("head"),s=e.listSelections().length;if(n=="eol")a=new o(a.line,Z(e,a.line));else if(n=="bol")a=new o(a.line,0);else if(n=="charAfter"){var l=c(e,a,J(a,0,1));a=l.end}else if(n=="firstNonBlank"){var l=c(e,a,Me.moveToFirstNonWhiteSpaceCharacter(e,a));a=l.end}else if(n=="startOfSelectedArea"){if(!r.visualMode)return;r.visualBlock?(a=new o(Math.min(i.head.line,i.anchor.line),Math.min(i.head.ch,i.anchor.ch)),s=Math.abs(i.head.line-i.anchor.line)+1):i.head.line<i.anchor.line?a=i.head:a=new o(i.anchor.line,0)}else if(n=="endOfSelectedArea"){if(!r.visualMode)return;r.visualBlock?(a=new o(Math.min(i.head.line,i.anchor.line),Math.max(i.head.ch,i.anchor.ch)+1),s=Math.abs(i.head.line-i.anchor.line)+1):i.head.line>=i.anchor.line?a=J(i.head,0,1):a=new o(i.anchor.line,0)}else if(n=="inplace"){if(r.visualMode)return}else n=="lastEdit"&&(a=Ft(e)||a);e.setOption("disableInput",!1),t&&t.replace?(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),f.signal(e,"vim-mode-change",{mode:"replace"})):(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),f.signal(e,"vim-mode-change",{mode:"insert"})),b.macroModeState.isPlaying||(e.on("change",Wt),r.insertEnd&&r.insertEnd.clear(),r.insertEnd=e.setBookmark(a,{insertLeft:!0}),f.on(e.getInputField(),"keydown",Ut)),r.visualMode&&ye(e),xt(e,a,s)}},toggleVisualMode:function(e,t,r){var n=t.repeat,i=e.getCursor(),a;if(r.visualMode)r.visualLine!=!!t.linewise||r.visualBlock!=!!t.blockwise?(r.visualLine=!!t.linewise,r.visualBlock=!!t.blockwise,f.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""}),Fe(e)):ye(e);else{r.visualMode=!0,r.visualLine=!!t.linewise,r.visualBlock=!!t.blockwise,a=re(e,new o(i.line,i.ch+n-1));var s=c(e,i,a);r.sel={anchor:s.start,head:s.end},f.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""}),Fe(e),be(e,r,"<",ae(i,a)),be(e,r,">",Te(i,a))}},reselectLastSelection:function(e,t,r){var n=r.lastSelection;if(r.visualMode&&Mt(e,r),n){var i=n.anchorMark.find(),a=n.headMark.find();if(!i||!a)return;r.sel={anchor:i,head:a},r.visualMode=!0,r.visualLine=n.visualLine,r.visualBlock=n.visualBlock,Fe(e),be(e,r,"<",ae(i,a)),be(e,r,">",Te(i,a)),f.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""})}},joinLines:function(e,t,r){var n,i;if(r.visualMode){if(n=e.getCursor("anchor"),i=e.getCursor("head"),$(i,n)){var a=i;i=n,n=a}i.ch=Z(e,i.line)-1}else{var s=Math.max(t.repeat,2);n=e.getCursor(),i=re(e,new o(n.line+s-1,1/0))}for(var l=0,u=n.line;u<i.line;u++){l=Z(e,n.line);var d="",v=0;if(!t.keepSpaces){var m=e.getLine(n.line+1);v=m.search(/\S/),v==-1?v=m.length:d=" "}e.replaceRange(d,new o(n.line,l),new o(n.line+1,v))}var C=re(e,new o(n.line,l));r.visualMode&&ye(e,!1),e.setCursor(C)},newLineAndEnterInsertMode:function(e,t,r){r.insertMode=!0;var n=H(e.getCursor());if(n.line===e.firstLine()&&!t.after)e.replaceRange(`
`,new o(e.firstLine(),0)),e.setCursor(e.firstLine(),0);else{n.line=t.after?n.line:n.line-1,n.ch=Z(e,n.line),e.setCursor(n);var i=f.commands.newlineAndIndentContinueComment||f.commands.newlineAndIndent;i(e)}this.enterInsertMode(e,{repeat:t.repeat},r)},paste:function(e,t,r){var n=b.registerController.getRegister(t.registerName);if(t.registerName==="+")navigator.clipboard.readText().then(a=>{this.continuePaste(e,t,r,a,n)});else{var i=n.toString();this.continuePaste(e,t,r,i,n)}},continuePaste:function(e,t,r,n,i){var a=H(e.getCursor());if(n){if(t.matchIndent){var s=e.getOption("tabSize"),l=function(ee){var z=ee.split("	").length-1,Ce=ee.split(" ").length-1;return z*s+Ce*1},u=e.getLine(e.getCursor().line),d=l(u.match(/^\s*/)[0]),v=n.replace(/\n$/,""),m=n!==v,C=l(n.match(/^\s*/)[0]),n=v.replace(/^\s*/gm,function(ee){var z=d+(l(ee)-C);if(z<0)return"";if(e.getOption("indentWithTabs")){var Ce=Math.floor(z/s);return Array(Ce+1).join("	")}else return Array(z+1).join(" ")});n+=m?`
`:""}if(t.repeat>1)var n=Array(t.repeat+1).join(n);var g=i.linewise,p=i.blockwise;if(p){n=n.split(`
`),g&&n.pop();for(var w=0;w<n.length;w++)n[w]=n[w]==""?" ":n[w];a.ch+=t.after?1:0,a.ch=Math.min(Z(e,a.line),a.ch)}else g?r.visualMode?n=r.visualLine?n.slice(0,-1):`
`+n.slice(0,n.length-1)+`
`:t.after?(n=`
`+n.slice(0,n.length-1),a.ch=Z(e,a.line)):a.ch=0:a.ch+=t.after?1:0;var S;if(r.visualMode){r.lastPastedText=n;var E,T=xr(e,r),A=T[0],_=T[1],te=e.getSelection(),q=e.listSelections(),Y=new Array(q.length).join("1").split("1");r.lastSelection&&(E=r.lastSelection.headMark.find()),b.registerController.unnamedRegister.setText(te),p?(e.replaceSelections(Y),_=new o(A.line+n.length-1,A.ch),e.setCursor(A),St(e,_),e.replaceSelections(n),S=A):r.visualBlock?(e.replaceSelections(Y),e.setCursor(A),e.replaceRange(n,A,A),S=A):(e.replaceRange(n,A,_),S=e.posFromIndex(e.indexFromPos(A)+n.length-1)),E&&(r.lastSelection.headMark=e.setBookmark(E)),g&&(S.ch=0)}else if(p){e.setCursor(a);for(var w=0;w<n.length;w++){var B=a.line+w;B>e.lastLine()&&e.replaceRange(`
`,new o(B,0));var N=Z(e,B);N<a.ch&&wr(e,B,a.ch)}e.setCursor(a),St(e,new o(a.line+n.length-1,a.ch)),e.replaceSelections(n),S=a}else if(e.replaceRange(n,a),g){var B=t.after?a.line+1:a.line;S=new o(B,me(e.getLine(B)))}else S=H(a),/\n/.test(n)||(S.ch+=n.length-(t.after?1:0));r.visualMode&&ye(e,!1),e.setCursor(S)}},undo:function(e,t){e.operation(function(){kt(e,f.commands.undo,t.repeat)(),e.setCursor(re(e,e.getCursor("start")))})},redo:function(e,t){kt(e,f.commands.redo,t.repeat)()},setRegister:function(e,t,r){r.inputState.registerName=t.selectedCharacter},insertRegister:function(e,t,r){var n=t.selectedCharacter,i=b.registerController.getRegister(n),a=i&&i.toString();a&&e.replaceSelection(a)},oneNormalCommand:function(e,t,r){Ae(e,!0),r.insertModeReturn=!0,f.on(e,"vim-command-done",function n(){r.visualMode||(r.insertModeReturn&&(r.insertModeReturn=!1,r.insertMode||_e.enterInsertMode(e,{},r)),f.off(e,"vim-command-done",n))})},setMark:function(e,t,r){var n=t.selectedCharacter;n&&be(e,r,n,e.getCursor())},replace:function(e,t,r){var n=t.selectedCharacter||"",i=e.getCursor(),a,s,l=e.listSelections();if(r.visualMode)i=e.getCursor("start"),s=e.getCursor("end");else{var u=e.getLine(i.line);a=i.ch+t.repeat,a>u.length&&(a=u.length),s=new o(i.line,a)}var d=c(e,i,s);if(i=d.start,s=d.end,n==`
`)r.visualMode||e.replaceRange("",i,s),(f.commands.newlineAndIndentContinueComment||f.commands.newlineAndIndent)(e);else{var v=e.getRange(i,s);if(v=v.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,n),v=v.replace(/[^\n]/g,n),r.visualBlock){var m=new Array(e.getOption("tabSize")+1).join(" ");v=e.getSelection(),v=v.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,n);var C=v.replace(/\t/g,m).replace(/[^\n]/g,n).split(`
`);e.replaceSelections(C)}else e.replaceRange(v,i,s);r.visualMode?(i=$(l[0].anchor,l[0].head)?l[0].anchor:l[0].head,e.setCursor(i),ye(e,!1)):e.setCursor(J(s,0,-1))}},incrementNumberToken:function(e,t){for(var r=e.getCursor(),n=e.getLine(r.line),i=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi,a,s,l,u;(a=i.exec(n))!==null&&(s=a.index,l=s+a[0].length,!(r.ch<l)););if(!(!t.backtrack&&l<=r.ch)){if(a){var d=a[2]||a[4],v=a[3]||a[5],m=t.increase?1:-1,C={"0b":2,0:8,"":10,"0x":16}[d.toLowerCase()],g=parseInt(a[1]+v,C)+m*t.repeat;u=g.toString(C);var p=d?new Array(v.length-u.length+1+a[1].length).join("0"):"";u.charAt(0)==="-"?u="-"+d+p+u.substr(1):u=d+p+u;var w=new o(r.line,s),S=new o(r.line,l);e.replaceRange(u,w,S)}else return;e.setCursor(new o(r.line,s+u.length-1))}},repeatLastEdit:function(e,t,r){var n=r.lastEditInputState;if(n){var i=t.repeat;i&&t.repeatIsExplicit?n.repeatOverride=i:i=n.repeatOverride||i,Qt(e,r,i,!1)}},indent:function(e,t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:function(e,t){Ae(e)}};function gr(e,t){_e[e]=t}function re(e,t,r){var n=e.state.vim,i=n.insertMode||n.visualMode,a=Math.min(Math.max(e.firstLine(),t.line),e.lastLine()),s=e.getLine(a),l=s.length-1+ +!!i,u=Math.min(Math.max(0,t.ch),l),d=s.charCodeAt(u);if(56320<=d&&d<=57343){var v=1;r&&r.line==a&&r.ch>u&&(v=-1),u+=v,u>l&&(u-=2)}return new o(a,u)}function ze(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function J(e,t,r){return typeof t=="object"&&(r=t.ch,t=t.line),new o(e.line+t,e.ch+r)}function yr(e,t,r,n){n.operator&&(r="operatorPending");for(var i,a=[],s=[],l=Ve?t.length-y:0,u=l;u<t.length;u++){var d=t[u];r=="insert"&&d.context!="insert"||d.context&&d.context!=r||n.operator&&d.type=="action"||!(i=mr(e,d.keys))||(i=="partial"&&a.push(d),i=="full"&&s.push(d))}return{partial:a.length&&a,full:s.length&&s}}function mr(e,t){const r=t.slice(-11)=="<character>",n=t.slice(-10)=="<register>";if(r||n){var i=t.length-(r?11:10),a=e.slice(0,i),s=t.slice(0,i);return a==s&&e.length>i?"full":s.indexOf(a)==0?"partial":!1}else return e==t?"full":t.indexOf(e)==0?"partial":!1}function Cr(e){var t=/^.*(<[^>]+>)$/.exec(e),r=t?t[1]:e.slice(-1);if(r.length>1)switch(r){case"<CR>":case"<S-CR>":r=`
`;break;case"<Space>":case"<S-Space>":r=" ";break;default:r="";break}return r}function kt(e,t,r){return function(){for(var n=0;n<r;n++)t(e)}}function H(e){return new o(e.line,e.ch)}function ce(e,t){return e.ch==t.ch&&e.line==t.line}function $(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function ae(e,t){return arguments.length>2&&(t=ae.apply(void 0,Array.prototype.slice.call(arguments,1))),$(e,t)?e:t}function Te(e,t){return arguments.length>2&&(t=Te.apply(void 0,Array.prototype.slice.call(arguments,1))),$(e,t)?t:e}function wt(e,t,r){var n=$(e,t),i=$(t,r);return n&&i}function Z(e,t){return e.getLine(t).length}function tt(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function kr(e){return e.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function wr(e,t,r){var n=Z(e,t),i=new Array(r-n+1).join(" ");e.setCursor(new o(t,n)),e.replaceRange(i,e.getCursor())}function St(e,t){var r=[],n=e.listSelections(),i=H(e.clipPos(t)),a=!ce(t,i),s=e.getCursor("head"),l=Sr(n,s),u=ce(n[l].head,n[l].anchor),d=n.length-1,v=d-l>l?d:0,m=n[v].anchor,C=Math.min(m.line,i.line),g=Math.max(m.line,i.line),p=m.ch,w=i.ch,S=n[v].head.ch-p,E=w-p;S>0&&E<=0?(p++,a||w--):S<0&&E>=0?(p--,u||w++):S<0&&E==-1&&(p--,w++);for(var T=C;T<=g;T++){var A={anchor:new o(T,p),head:new o(T,w)};r.push(A)}return e.setSelections(r),t.ch=w,m.ch=p,m}function xt(e,t,r){for(var n=[],i=0;i<r;i++){var a=J(t,i,0);n.push({anchor:a,head:a})}e.setSelections(n,0)}function Sr(e,t,r){for(var n=0;n<e.length;n++){var i=ce(e[n].anchor,t),a=ce(e[n].head,t);if(i||a)return n}return-1}function xr(e,t){var r=t.lastSelection,n=function(){var a=e.listSelections(),s=a[0],l=a[a.length-1],u=$(s.anchor,s.head)?s.anchor:s.head,d=$(l.anchor,l.head)?l.head:l.anchor;return[u,d]},i=function(){var a=e.getCursor(),s=e.getCursor(),l=r.visualBlock;if(l){var u=l.width,d=l.height;s=new o(a.line+d,a.ch+u);for(var v=[],m=a.line;m<s.line;m++){var C=new o(m,a.ch),g=new o(m,s.ch),p={anchor:C,head:g};v.push(p)}e.setSelections(v)}else{var w=r.anchorMark.find(),S=r.headMark.find(),E=S.line-w.line,T=S.ch-w.ch;s={line:s.line+E,ch:E?s.ch:T+s.ch},r.visualLine&&(a=new o(a.line,0),s=new o(s.line,Z(e,s.line))),e.setSelection(a,s)}return[a,s]};return t.visualMode?n():i()}function Mt(e,t){var r=t.sel.anchor,n=t.sel.head;t.lastPastedText&&(n=e.posFromIndex(e.indexFromPos(r)+t.lastPastedText.length),t.lastPastedText=null),t.lastSelection={anchorMark:e.setBookmark(r),headMark:e.setBookmark(n),anchor:H(r),head:H(n),visualMode:t.visualMode,visualLine:t.visualLine,visualBlock:t.visualBlock}}function Mr(e,t,r,n){var i=e.state.vim.sel,a=n?t:i.head,s=n?t:i.anchor,l;return $(r,t)&&(l=r,r=t,t=l),$(a,s)?(a=ae(t,a),s=Te(s,r)):(s=ae(t,s),a=Te(a,r),a=J(a,0,-1),a.ch==-1&&a.line!=e.firstLine()&&(a=new o(a.line-1,Z(e,a.line-1)))),[s,a]}function Fe(e,t,r){var n=e.state.vim;t=t||n.sel,r||(r=n.visualLine?"line":n.visualBlock?"block":"char");var i=rt(e,t,r);e.setSelections(i.ranges,i.primary)}function rt(e,t,r,n){var i=H(t.head),a=H(t.anchor);if(r=="char"){var s=!n&&!$(t.head,t.anchor)?1:0,l=$(t.head,t.anchor)?1:0;return i=J(t.head,0,s),a=J(t.anchor,0,l),{ranges:[{anchor:a,head:i}],primary:0}}else if(r=="line"){if($(t.head,t.anchor))i.ch=0,a.ch=Z(e,a.line);else{a.ch=0;var u=e.lastLine();i.line>u&&(i.line=u),i.ch=Z(e,i.line)}return{ranges:[{anchor:a,head:i}],primary:0}}else if(r=="block"){var d=Math.min(a.line,i.line),v=a.ch,m=Math.max(a.line,i.line),C=i.ch;v<C?C+=1:v+=1;for(var g=m-d+1,p=i.line==d?0:g-1,w=[],S=0;S<g;S++)w.push({anchor:new o(d+S,v),head:new o(d+S,C)});return{ranges:w,primary:p}}throw"never happens"}function br(e){var t=e.getCursor("head");return e.getSelection().length==1&&(t=ae(t,e.getCursor("anchor"))),t}function ye(e,t){var r=e.state.vim;t!==!1&&e.setCursor(re(e,r.sel.head)),Mt(e,r),r.visualMode=!1,r.visualLine=!1,r.visualBlock=!1,r.insertMode||f.signal(e,"vim-mode-change",{mode:"normal"})}function Lr(e,t,r){var n=e.getRange(t,r);if(/\n\s*$/.test(n)){var i=n.split(`
`);i.pop();for(var a=i.pop();i.length>0&&a&&j(a);a=i.pop())r.line--,r.ch=0;a?(r.line--,r.ch=Z(e,r.line)):r.ch=0}}function Tr(e,t,r){t.ch=0,r.ch=0,r.line++}function me(e){if(!e)return 0;var t=e.search(/\S/);return t==-1?e.length:t}function nt(e,{inclusive:t,innerWord:r,bigWord:n,noSymbol:i,multiline:a},s){var l=s||br(e),u=e.getLine(l.line),d=u,v=l.line,m=v,C=l.ch,g,p=i?I[0]:O[0];if(r&&/\s/.test(u.charAt(C)))p=function(_){return/\s/.test(_)};else{for(;!p(u.charAt(C));)if(C++,C>=u.length){if(!a)return null;C--,g=Et(e,l,!0,n,!0);break}n?p=O[0]:(p=I[0],p(u.charAt(C))||(p=I[1]))}for(var w=C,S=C;p(u.charAt(S))&&S>=0;)S--;if(S++,g)w=g.to,m=g.line,d=e.getLine(m),!d&&w==0&&w++;else for(;p(u.charAt(w))&&w<u.length;)w++;if(t){var E=w,T=l.ch<=S&&/\s/.test(u.charAt(l.ch));if(!T)for(;/\s/.test(d.charAt(w))&&w<d.length;)w++;if(E==w||T){for(var A=S;/\s/.test(u.charAt(S-1))&&S>0;)S--;!S&&!T&&(S=A)}}return{start:new o(v,S),end:new o(m,w)}}function Er(e,t,r){var n=t;if(!f.findMatchingTag||!f.findEnclosingTag)return{start:n,end:n};var i=f.findMatchingTag(e,t)||f.findEnclosingTag(e,t);return!i||!i.open||!i.close?{start:n,end:n}:r?{start:i.open.from,end:i.close.to}:{start:i.open.to,end:i.close.from}}function bt(e,t,r){ce(t,r)||b.jumpList.add(e,t,r)}function Lt(e,t){b.lastCharacterSearch.increment=e,b.lastCharacterSearch.forward=t.forward,b.lastCharacterSearch.selectedCharacter=t.selectedCharacter}var Ar={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},Tt={bracket:{isComplete:function(e){if(e.nextCh===e.symb){if(e.depth++,e.depth>=1)return!0}else e.nextCh===e.reverseSymb&&e.depth--;return!1}},section:{init:function(e){e.curMoveThrough=!0,e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return e.index===0&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t=e.lastCh==="*"&&e.nextCh==="/";return e.lastCh=e.nextCh,t}},method:{init:function(e){e.symb=e.symb==="m"?"{":"}",e.reverseSymb=e.symb==="{"?"}":"{"},isComplete:function(e){return e.nextCh===e.symb}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if(e.nextCh==="#"){var t=e.lineText.match(/^#(\w+)/)[1];if(t==="endif"){if(e.forward&&e.depth===0)return!0;e.depth++}else if(t==="if"){if(!e.forward&&e.depth===0)return!0;e.depth--}if(t==="else"&&e.depth===0)return!0}return!1}}};function Or(e,t,r,n){var i=H(e.getCursor()),a=r?1:-1,s=r?e.lineCount():-1,l=i.ch,u=i.line,d=e.getLine(u),v={lineText:d,nextCh:d.charAt(l),lastCh:null,index:l,symb:n,reverseSymb:(r?{")":"(","}":"{"}:{"(":")","{":"}"})[n],forward:r,depth:0,curMoveThrough:!1},m=Ar[n];if(!m)return i;var C=Tt[m].init,g=Tt[m].isComplete;for(C&&C(v);u!==s&&t;){if(v.index+=a,v.nextCh=v.lineText.charAt(v.index),!v.nextCh){if(u+=a,v.lineText=e.getLine(u)||"",a>0)v.index=0;else{var p=v.lineText.length;v.index=p>0?p-1:0}v.nextCh=v.lineText.charAt(v.index)}g(v)&&(i.line=u,i.ch=v.index,t--)}return v.nextCh||v.curMoveThrough?new o(u,v.index):i}function Et(e,t,r,n,i){var a=t.line,s=t.ch,l=e.getLine(a),u=r?1:-1,d=n?O:I;if(i&&l==""){if(a+=u,l=e.getLine(a),!le(e,a))return null;s=r?0:l.length}for(;;){if(i&&l=="")return{from:0,to:0,line:a};for(var v=u>0?l.length:-1,m=v,C=v;s!=v;){for(var g=!1,p=0;p<d.length&&!g;++p)if(d[p](l.charAt(s))){for(m=s;s!=v&&d[p](l.charAt(s));)s+=u;if(C=s,g=m!=C,m==t.ch&&a==t.line&&C==m+u)continue;return{from:Math.min(m,C+1),to:Math.max(m,C),line:a}}g||(s+=u)}if(a+=u,!le(e,a))return null;l=e.getLine(a),s=u>0?0:l.length}}function Rr(e,t,r,n,i,a){var s=H(t),l=[];(n&&!i||!n&&i)&&r++;for(var u=!(n&&i),d=0;d<r;d++){var v=Et(e,t,n,a,u);if(!v){var m=Z(e,e.lastLine());l.push(n?{line:e.lastLine(),from:m,to:m}:{line:0,from:0,to:0});break}l.push(v),t=new o(v.line,n?v.to-1:v.from)}var C=l.length!=r,g=l[0],p=l.pop();return n&&!i?(!C&&(g.from!=s.ch||g.line!=s.line)&&(p=l.pop()),p&&new o(p.line,p.from)):n&&i?p&&new o(p.line,p.to-1):!n&&i?(!C&&(g.to!=s.ch||g.line!=s.line)&&(p=l.pop()),p&&new o(p.line,p.to)):p&&new o(p.line,p.from)}function At(e,t,r,n,i){var a=t,s=new o(a.line+r.repeat-1,1/0),l=e.clipPos(s);return l.ch--,i||(n.lastHPos=1/0,n.lastHSPos=e.charCoords(l,"div").left),s}function it(e,t,r,n,i){if(n){for(var a=i||e.getCursor(),s=a.ch,l,u=0;u<t;u++){var d=e.getLine(a.line);if(l=Br(s,d,n,r,!0),l==-1)return;s=l}if(l!=null)return new o(e.getCursor().line,l)}}function Ir(e,t){var r=e.getCursor().line;return re(e,new o(r,t-1))}function be(e,t,r,n){!Xe(r,V)&&!U.test(r)||(t.marks[r]&&t.marks[r].clear(),t.marks[r]=e.setBookmark(n))}function Br(e,t,r,n,i){var a;return n?(a=t.indexOf(r,e+1),a!=-1&&!i&&(a-=1)):(a=t.lastIndexOf(r,e-1),a!=-1&&!i&&(a+=1)),a}function Ot(e,t,r,n,i){var a=t.line,s=e.firstLine(),l=e.lastLine(),u,d,v=a;function m(S){return!e.getLine(S)}function C(S,E,T){return T?m(S)!=m(S+E):!m(S)&&m(S+E)}if(n){for(;s<=v&&v<=l&&r>0;)C(v,n)&&r--,v+=n;return{start:new o(v,0),end:t}}var g=e.state.vim;if(g.visualLine&&C(a,1,!0)){var p=g.sel.anchor;C(p.line,-1,!0)&&(!i||p.line!=a)&&(a+=1)}var w=m(a);for(v=a;v<=l&&r;v++)C(v,1,!0)&&(!i||m(v)!=w)&&r--;for(d=new o(v,0),v>l&&!w?w=!0:i=!1,v=a;v>s&&!((!i||m(v)==w||v==a)&&C(v,-1,!0));v--);return u=new o(v,0),{start:u,end:d}}function Rt(e,t,r,n,i){function a(d){d.pos+d.dir<0||d.pos+d.dir>=d.line.length?d.line=null:d.pos+=d.dir}function s(d,v,m,C){var g=d.getLine(v),p={line:g,ln:v,pos:m,dir:C};if(p.line==="")return{ln:p.ln,pos:p.pos};var w=p.pos;for(a(p);p.line!==null;){if(w=p.pos,pe(p.line[p.pos]))if(i){for(a(p);p.line!==null&&j(p.line[p.pos]);)w=p.pos,a(p);return{ln:p.ln,pos:w+1}}else return{ln:p.ln,pos:p.pos+1};a(p)}return{ln:p.ln,pos:w+1}}function l(d,v,m,C){var g=d.getLine(v),p={line:g,ln:v,pos:m,dir:C};if(p.line==="")return{ln:p.ln,pos:p.pos};var w=p.pos;for(a(p);p.line!==null;){if(!j(p.line[p.pos])&&!pe(p.line[p.pos]))w=p.pos;else if(pe(p.line[p.pos]))return i?j(p.line[p.pos+1])?{ln:p.ln,pos:p.pos+1}:{ln:p.ln,pos:w}:{ln:p.ln,pos:w};a(p)}return p.line=g,i&&j(p.line[p.pos])?{ln:p.ln,pos:p.pos}:{ln:p.ln,pos:w}}for(var u={ln:t.line,pos:t.ch};r>0;)n<0?u=l(e,u.ln,u.pos,n):u=s(e,u.ln,u.pos,n),r--;return new o(u.ln,u.pos)}function Nr(e,t,r,n){function i(u,d){if(d.pos+d.dir<0||d.pos+d.dir>=d.line.length){if(d.ln+=d.dir,!le(u,d.ln)){d.line=null,d.ln=null,d.pos=null;return}d.line=u.getLine(d.ln),d.pos=d.dir>0?0:d.line.length-1}else d.pos+=d.dir}function a(u,d,v,m){var S=u.getLine(d),C=S==="",g={line:S,ln:d,pos:v,dir:m},p={ln:g.ln,pos:g.pos},w=g.line==="";for(i(u,g);g.line!==null;){if(p.ln=g.ln,p.pos=g.pos,g.line===""&&!w)return{ln:g.ln,pos:g.pos};if(C&&g.line!==""&&!j(g.line[g.pos]))return{ln:g.ln,pos:g.pos};pe(g.line[g.pos])&&!C&&(g.pos===g.line.length-1||j(g.line[g.pos+1]))&&(C=!0),i(u,g)}var S=u.getLine(p.ln);p.pos=0;for(var E=S.length-1;E>=0;--E)if(!j(S[E])){p.pos=E;break}return p}function s(u,d,v,m){var w=u.getLine(d),C={line:w,ln:d,pos:v,dir:m},g={ln:C.ln,pos:null},p=C.line==="";for(i(u,C);C.line!==null;){if(C.line===""&&!p)return g.pos!==null?g:{ln:C.ln,pos:C.pos};if(pe(C.line[C.pos])&&g.pos!==null&&!(C.ln===g.ln&&C.pos+1===g.pos))return g;C.line!==""&&!j(C.line[C.pos])&&(p=!1,g={ln:C.ln,pos:C.pos}),i(u,C)}var w=u.getLine(g.ln);g.pos=0;for(var S=0;S<w.length;++S)if(!j(w[S])){g.pos=S;break}return g}for(var l={ln:t.line,pos:t.ch};r>0;)n<0?l=s(e,l.ln,l.pos,n):l=a(e,l.ln,l.pos,n),r--;return new o(l.ln,l.pos)}function It(e,t,r,n){var i=t,a={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[r],s={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[r],l=e.getLine(i.line).charAt(i.ch),u=l===s?1:0,d=e.scanForBracket(new o(i.line,i.ch+u),-1,void 0,{bracketRegex:a}),v=e.scanForBracket(new o(i.line,i.ch+u),1,void 0,{bracketRegex:a});if(!d||!v)return null;var m=d.pos,C=v.pos;if(m.line==C.line&&m.ch>C.ch||m.line>C.line){var g=m;m=C,C=g}return n?C.ch+=1:m.ch+=1,{start:m,end:C}}function Pr(e,t,r,n){var i=H(t),a=e.getLine(i.line),s=a.split(""),l,u,d,v,m=s.indexOf(r);if(i.ch<m)i.ch=m;else if(m<i.ch&&s[i.ch]==r){var C=/string/.test(e.getTokenTypeAt(J(t,0,1))),g=/string/.test(e.getTokenTypeAt(t)),p=C&&!g;p||(u=i.ch,--i.ch)}if(s[i.ch]==r&&!u)l=i.ch+1;else for(d=i.ch;d>-1&&!l;d--)s[d]==r&&(l=d+1);if(l&&!u)for(d=l,v=s.length;d<v&&!u;d++)s[d]==r&&(u=d);return!l||!u?{start:i,end:i}:(n&&(--l,++u),{start:new o(i.line,l),end:new o(i.line,u)})}Ne("pcre",!0,"boolean");class Kr{getQuery(){return b.query}setQuery(t){b.query=t}getOverlay(){return this.searchOverlay}setOverlay(t){this.searchOverlay=t}isReversed(){return b.isReversed}setReversed(t){b.isReversed=t}getScrollbarAnnotate(){return this.annotate}setScrollbarAnnotate(t){this.annotate=t}}function de(e){var t=e.state.vim;return t.searchState_||(t.searchState_=new Kr)}function Dr(e){return Bt(e,"/")}function _r(e){return Nt(e,"/")}function Bt(e,t){var r=Nt(e,t)||[];if(!r.length)return[];var n=[];if(r[0]===0){for(var i=0;i<r.length;i++)typeof r[i]=="number"&&n.push(e.substring(r[i]+1,r[i+1]));return n}}function Nt(e,t){t||(t="/");for(var r=!1,n=[],i=0;i<e.length;i++){var a=e.charAt(i);!r&&a==t&&n.push(i),r=!r&&a=="\\"}return n}function Fr(e){for(var t="|(){",r="}",n=!1,i=[],a=-1;a<e.length;a++){var s=e.charAt(a)||"",l=e.charAt(a+1)||"",u=l&&t.indexOf(l)!=-1;n?((s!=="\\"||!u)&&i.push(s),n=!1):s==="\\"?(n=!0,l&&r.indexOf(l)!=-1&&(u=!0),(!u||l==="\\")&&i.push(s)):(i.push(s),u&&l!=="\\"&&i.push("\\"))}return i.join("")}var Pt={"\\n":`
`,"\\r":"\r","\\t":"	"};function Hr(e){for(var t=!1,r=[],n=-1;n<e.length;n++){var i=e.charAt(n)||"",a=e.charAt(n+1)||"";Pt[i+a]?(r.push(Pt[i+a]),n++):t?(r.push(i),t=!1):i==="\\"?(t=!0,Se(a)||a==="$"?r.push("$"):a!=="/"&&a!=="\\"&&r.push("\\")):(i==="$"&&r.push("$"),r.push(i),a==="/"&&r.push("\\"))}return r.join("")}var Kt={"\\/":"/","\\\\":"\\","\\n":`
`,"\\r":"\r","\\t":"	","\\&":"&"};function Vr(e){for(var t=new f.StringStream(e),r=[];!t.eol();){for(;t.peek()&&t.peek()!="\\";)r.push(t.next());var n=!1;for(var i in Kt)if(t.match(i,!0)){n=!0,r.push(Kt[i]);break}n||r.push(t.next())}return r.join("")}function Wr(e,t,r){var n=b.registerController.getRegister("/");if(n.setText(e),e instanceof RegExp)return e;var i=_r(e),a,s;if(!i.length)a=e;else{a=e.substring(0,i[0]);var l=e.substring(i[0]);s=l.indexOf("i")!=-1}if(!a)return null;Le("pcre")||(a=Fr(a)),r&&(t=/^[^A-Z]*$/.test(a));var u=new RegExp(a,t||s?"im":"m");return u}function Ee(e){typeof e=="string"&&(e=document.createElement(e));for(var t,r=1;r<arguments.length;r++)if(t=arguments[r])if(typeof t!="object"&&(t=document.createTextNode(t)),t.nodeType)e.appendChild(t);else for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(n[0]==="$"?e.style[n.slice(1)]=t[n]:e.setAttribute(n,t[n]));return e}function D(e,t){var r=Ee("div",{$color:"red",$whiteSpace:"pre",class:"cm-vim-message"},t);e.openNotification?e.openNotification(r,{bottom:!0,duration:5e3}):alert(r.innerText)}function jr(e,t){return Ee("div",{$display:"flex"},Ee("span",{$fontFamily:"monospace",$whiteSpace:"pre",$flex:1},e,Ee("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false",$width:"100%"})),t&&Ee("span",{$color:"#888"},t))}function $e(e,t){if(Ke.length){t.value||(t.value=""),Q=t;return}var r=jr(t.prefix,t.desc);if(e.openDialog)e.openDialog(r,t.onClose,{onKeyDown:t.onKeyDown,onKeyUp:t.onKeyUp,bottom:!0,selectValueOnOpen:!1,value:t.value});else{var n="";typeof t.prefix!="string"&&t.prefix&&(n+=t.prefix.textContent),t.desc&&(n+=" "+t.desc),t.onClose(prompt(n,""))}}function $r(e,t){if(e instanceof RegExp&&t instanceof RegExp){for(var r=["global","multiline","ignoreCase","source"],n=0;n<r.length;n++){var i=r[n];if(e[i]!==t[i])return!1}return!0}return!1}function Ue(e,t,r,n){if(t){var i=de(e),a=Wr(t,!!r,!!n);if(a)return Dt(e,a),$r(a,i.getQuery())||i.setQuery(a),a}}function Ur(e){if(e.source.charAt(0)=="^")var t=!0;return{token:function(r){if(t&&!r.sol()){r.skipToEnd();return}var n=r.match(e,!1);if(n)return n[0].length==0?(r.next(),"searching"):!r.sol()&&(r.backUp(1),!e.exec(r.next()+n[0]))?(r.next(),null):(r.match(e),"searching");for(;!r.eol()&&(r.next(),!r.match(e,!1)););},query:e}}var Qe=0;function Dt(e,t){clearTimeout(Qe);var r=de(e);r.highlightTimeout=Qe,Qe=setTimeout(function(){if(e.state.vim){var n=de(e);n.highlightTimeout=null;var i=n.getOverlay();(!i||t!=i.query)&&(i&&e.removeOverlay(i),i=Ur(t),e.addOverlay(i),e.showMatchesOnScrollbar&&(n.getScrollbarAnnotate()&&n.getScrollbarAnnotate().clear(),n.setScrollbarAnnotate(e.showMatchesOnScrollbar(t))),n.setOverlay(i))}},50)}function _t(e,t,r,n){return e.operation(function(){n===void 0&&(n=1);for(var i=e.getCursor(),a=e.getSearchCursor(r,i),s=0;s<n;s++){var l=a.find(t);if(s==0&&l&&ce(a.from(),i)){var u=t?a.from():a.to();l=a.find(t),l&&!l[0]&&ce(a.from(),u)&&e.getLine(u.line).length==u.ch&&(l=a.find(t))}if(!l&&(a=e.getSearchCursor(r,t?new o(e.lastLine()):new o(e.firstLine(),0)),!a.find(t)))return}return a.from()})}function Qr(e,t,r,n,i){return e.operation(function(){n===void 0&&(n=1);var a=e.getCursor(),s=e.getSearchCursor(r,a),l=s.find(!t);!i.visualMode&&l&&ce(s.from(),a)&&s.find(!t);for(var u=0;u<n;u++)if(l=s.find(t),!l&&(s=e.getSearchCursor(r,t?new o(e.lastLine()):new o(e.firstLine(),0)),!s.find(t)))return;return[s.from(),s.to()]})}function at(e){var t=de(e);t.highlightTimeout&&(clearTimeout(t.highlightTimeout),t.highlightTimeout=null),e.removeOverlay(de(e).getOverlay()),t.setOverlay(null),t.getScrollbarAnnotate()&&(t.getScrollbarAnnotate().clear(),t.setScrollbarAnnotate(null))}function Jr(e,t,r){return typeof e!="number"&&(e=e.line),t instanceof Array?Xe(e,t):typeof r=="number"?e>=t&&e<=r:e==t}function ot(e){var t=e.getScrollInfo(),r=6,n=10,i=e.coordsChar({left:0,top:r+t.top},"local"),a=t.clientHeight-n+t.top,s=e.coordsChar({left:0,top:a},"local");return{top:i.line,bottom:s.line}}function Ge(e,t,r){if(r=="'"||r=="`")return b.jumpList.find(e,-1)||new o(0,0);if(r==".")return Ft(e);var n=t.marks[r];return n&&n.find()}function Ft(e){if(e.getLastEditEnd)return e.getLastEditEnd();for(var t=e.doc.history.done,r=t.length;r--;)if(t[r].changes)return H(t[r].changes[0].to)}class qr{constructor(){this.commandMap_,this.buildCommandMap_()}processCommand(t,r,n){var i=this;t.operation(function(){t.curOp.isVimOp=!0,i._processCommand(t,r,n)})}_processCommand(t,r,n){var i=t.state.vim,a=b.registerController.getRegister(":"),s=a.toString(),l=new f.StringStream(r);a.setText(r);var u=n||{};u.input=r;try{this.parseInput_(t,l,u)}catch(m){throw D(t,m+""),m}i.visualMode&&ye(t);var d,v;if(!u.commandName)u.line!==void 0&&(v="move");else if(d=this.matchCommand_(u.commandName),d){if(v=d.name,d.excludeFromCommandHistory&&a.setText(s),this.parseCommandArgs_(l,u,d),d.type=="exToKey"){We(t,d.toKeys,d);return}else if(d.type=="exToEx"){this.processCommand(t,d.toInput);return}}if(!v){D(t,'Not an editor command ":'+r+'"');return}try{Ht[v](t,u),(!d||!d.possiblyAsync)&&u.callback&&u.callback()}catch(m){throw D(t,m+""),m}}parseInput_(t,r,n){var a,s;r.eatWhile(":"),r.eat("%")?(n.line=t.firstLine(),n.lineEnd=t.lastLine()):(n.line=this.parseLineSpec_(t,r),n.line!==void 0&&r.eat(",")&&(n.lineEnd=this.parseLineSpec_(t,r))),n.line==null?t.state.vim.visualMode?(n.selectionLine=(a=Ge(t,t.state.vim,"<"))==null?void 0:a.line,n.selectionLineEnd=(s=Ge(t,t.state.vim,">"))==null?void 0:s.line):n.selectionLine=t.getCursor().line:(n.selectionLine=n.line,n.selectionLineEnd=n.lineEnd);var i=r.match(/^(\w+|!!|@@|[!#&*<=>@~])/);return i?n.commandName=i[1]:n.commandName=r.match(/.*/)[0],n}parseLineSpec_(t,r){var n=r.match(/^(\d+)/);if(n)return parseInt(n[1],10)-1;switch(r.next()){case".":return this.parseLineSpecOffset_(r,t.getCursor().line);case"$":return this.parseLineSpecOffset_(r,t.lastLine());case"'":var i=r.next(),a=Ge(t,t.state.vim,i);if(!a)throw new Error("Mark not set");return this.parseLineSpecOffset_(r,a.line);case"-":case"+":return r.backUp(1),this.parseLineSpecOffset_(r,t.getCursor().line);default:r.backUp(1);return}}parseLineSpecOffset_(t,r){var n=t.match(/^([+-])?(\d+)/);if(n){var i=parseInt(n[2],10);n[1]=="-"?r-=i:r+=i}return r}parseCommandArgs_(t,r,n){if(!t.eol()){r.argString=t.match(/.*/)[0];var i=n.argDelimiter||/\s+/,a=tt(r.argString).split(i);a.length&&a[0]&&(r.args=a)}}matchCommand_(t){for(var r=t.length;r>0;r--){var n=t.substring(0,r);if(this.commandMap_[n]){var i=this.commandMap_[n];if(i.name.indexOf(t)===0)return i}}return null}buildCommandMap_(){this.commandMap_={};for(var t=0;t<k.length;t++){var r=k[t],n=r.shortName||r.name;this.commandMap_[n]=r}}map(t,r,n,i){if(t!=":"&&t.charAt(0)==":"){if(n)throw Error("Mode not supported for ex mappings");var a=t.substring(1);r!=":"&&r.charAt(0)==":"?this.commandMap_[a]={name:a,type:"exToEx",toInput:r.substring(1),user:!0}:this.commandMap_[a]={name:a,type:"exToKey",toKeys:r,user:!0}}else{var s={keys:t,type:"keyToKey",toKeys:r,noremap:!!i};n&&(s.context=n),h.unshift(s)}}unmap(t,r){if(t!=":"&&t.charAt(0)==":"){if(r)throw Error("Mode not supported for ex mappings");var n=t.substring(1);if(this.commandMap_[n]&&this.commandMap_[n].user)return delete this.commandMap_[n],!0}else for(var i=t,a=0;a<h.length;a++)if(i==h[a].keys&&h[a].context===r)return h.splice(a,1),!0}}var Ht={colorscheme:function(e,t){if(!t.args||t.args.length<1){D(e,e.getOption("theme"));return}e.setOption("theme",t.args[0])},map:function(e,t,r,n){var i=t.args;if(!i||i.length<2){e&&D(e,"Invalid mapping: "+t.input);return}ve.map(i[0],i[1],r,n)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},omap:function(e,t){this.map(e,t,"operatorPending")},noremap:function(e,t){this.map(e,t,void 0,!0)},inoremap:function(e,t){this.map(e,t,"insert",!0)},nnoremap:function(e,t){this.map(e,t,"normal",!0)},vnoremap:function(e,t){this.map(e,t,"visual",!0)},onoremap:function(e,t){this.map(e,t,"operatorPending",!0)},unmap:function(e,t,r){var n=t.args;(!n||n.length<1||!ve.unmap(n[0],r))&&e&&D(e,"No such mapping: "+t.input)},mapclear:function(e,t){fe.mapclear()},imapclear:function(e,t){fe.mapclear("insert")},nmapclear:function(e,t){fe.mapclear("normal")},vmapclear:function(e,t){fe.mapclear("visual")},omapclear:function(e,t){fe.mapclear("operatorPending")},move:function(e,t){Re.processCommand(e,e.state.vim,{keys:"",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:t.line+1})},set:function(e,t){var r=t.args,n=t.setCfg||{};if(!r||r.length<1){e&&D(e,"Invalid mapping: "+t.input);return}var i=r[0].split("="),a=i.shift()||"",s=i.length>0?i.join("="):void 0,l=!1,u=!1;if(a.charAt(a.length-1)=="?"){if(s)throw Error("Trailing characters: "+t.argString);a=a.substring(0,a.length-1),l=!0}else a.charAt(a.length-1)=="!"&&(a=a.substring(0,a.length-1),u=!0);s===void 0&&a.substring(0,2)=="no"&&(a=a.substring(2),s=!1);var d=xe[a]&&xe[a].type=="boolean";if(d&&(u?s=!Le(a,e,n):s==null&&(s=!0)),!d&&s===void 0||l){var v=Le(a,e,n);v instanceof Error?D(e,v.message):v===!0||v===!1?D(e," "+(v?"":"no")+a):D(e,"  "+a+"="+v)}else{var m=Ze(a,s,e,n);m instanceof Error&&D(e,m.message)}},setlocal:function(e,t){t.setCfg={scope:"local"},this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"},this.set(e,t)},registers:function(e,t){var r=t.args,n=b.registerController.registers,i=`----------Registers----------

`;if(r)for(var l=r.join(""),u=0;u<l.length;u++){var a=l.charAt(u);if(b.registerController.isValidRegister(a)){var d=n[a]||new ge;i+='"'+a+"    "+d.toString()+`
`}}else for(var a in n){var s=n[a].toString();s.length&&(i+='"'+a+"    "+s+`
`)}D(e,i)},sort:function(e,t){var r,n,i,a,s;function l(){if(t.argString){var B=new f.StringStream(t.argString);if(B.eat("!")&&(r=!0),B.eol())return;if(!B.eatSpace())return"Invalid arguments";var N=B.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!N||!B.eol())return"Invalid arguments";if(N[1]){n=N[1].indexOf("i")!=-1,i=N[1].indexOf("u")!=-1;var ne=N[1].indexOf("d")!=-1||N[1].indexOf("n")!=-1,ee=N[1].indexOf("x")!=-1,z=N[1].indexOf("o")!=-1;if(Number(ne)+Number(ee)+Number(z)>1)return"Invalid arguments";a=ne&&"decimal"||ee&&"hex"||z&&"octal"}N[2]&&(s=new RegExp(N[2].substr(1,N[2].length-2),n?"i":""))}}var u=l();if(u){D(e,u+": "+t.argString);return}var d=t.line||e.firstLine(),v=t.lineEnd||t.line||e.lastLine();if(d==v)return;var m=new o(d,0),C=new o(v,Z(e,v)),g=e.getRange(m,C).split(`
`),p=a=="decimal"?/(-?)([\d]+)/:a=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:a=="octal"?/([0-7]+)/:null,w=a=="decimal"?10:a=="hex"?16:a=="octal"?8:void 0,S=[],E=[];if(a||s)for(var T=0;T<g.length;T++){var A=s?g[T].match(s):null;A&&A[0]!=""?S.push(A):p&&p.exec(g[T])?S.push(g[T]):E.push(g[T])}else E=g;function _(B,N){if(r){var ne;ne=B,B=N,N=ne}n&&(B=B.toLowerCase(),N=N.toLowerCase());var ee=p&&p.exec(B),z=p&&p.exec(N);if(!ee||!z)return B<N?-1:1;var Ce=parseInt((ee[1]+ee[2]).toLowerCase(),w),ut=parseInt((z[1]+z[2]).toLowerCase(),w);return Ce-ut}function te(B,N){if(r){var ne;ne=B,B=N,N=ne}return n&&(B[0]=B[0].toLowerCase(),N[0]=N[0].toLowerCase()),B[0]<N[0]?-1:1}if(S.sort(s?te:_),s)for(var T=0;T<S.length;T++)S[T]=S[T].input;else a||E.sort(_);if(g=r?S.concat(E):E.concat(S),i){var q=g,Y;g=[];for(var T=0;T<q.length;T++)q[T]!=Y&&g.push(q[T]),Y=q[T]}e.replaceRange(g.join(`
`),m,C)},vglobal:function(e,t){this.global(e,t)},normal:function(e,t){var r=t.argString;if(r&&r[0]=="!"&&(r=r.slice(1),Ve=!0),r=r.trimStart(),!r){D(e,"Argument is required.");return}var n=t.line;if(typeof n=="number")for(var i=isNaN(t.lineEnd)?n:t.lineEnd,a=n;a<=i;a++)e.setCursor(a,0),We(e,t.argString.trimStart()),e.state.vim.insertMode&&Ae(e,!0);else We(e,t.argString.trimStart()),e.state.vim.insertMode&&Ae(e,!0)},global:function(e,t){var r=t.argString;if(!r){D(e,"Regular Expression missing from global");return}var n=t.commandName[0]==="v";r[0]==="!"&&t.commandName[0]==="g"&&(n=!0,r=r.slice(1));var i=t.line!==void 0?t.line:e.firstLine(),a=t.lineEnd||t.line||e.lastLine(),s=Dr(r),l=r,u="";if(s&&s.length&&(l=s[0],u=s.slice(1,s.length).join("/")),l)try{Ue(e,l,!0,!0)}catch{D(e,"Invalid regex: "+l);return}for(var d=de(e).getQuery(),v=[],m=i;m<=a;m++){var C=e.getLine(m),g=d.test(C);g!==n&&v.push(u?e.getLineHandle(m):C)}if(!u){D(e,v.join(`
`));return}var p=0,w=function(){if(p<v.length){var S=v[p++],E=e.getLineNumber(S);if(E==null){w();return}var T=E+1+u;ve.processCommand(e,T,{callback:w})}else e.releaseLineHandles&&e.releaseLineHandles()};w()},substitute:function(e,t){if(!e.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var r=t.argString,n=r?Bt(r,r[0]):[],i="",a="",s,l,u,d=!1,v=!1;if(n&&n.length)i=n[0],Le("pcre")&&i!==""&&(i=new RegExp(i).source),a=n[1],a!==void 0&&(Le("pcre")?a=Vr(a.replace(/([^\\])&/g,"$1$$&")):a=Hr(a),b.lastSubstituteReplacePart=a),s=n[2]?n[2].split(" "):[];else if(r&&r.length){D(e,"Substitutions should be of the form :s/pattern/replace/");return}if(s&&(l=s[0],u=parseInt(s[1]),l&&(l.indexOf("c")!=-1&&(d=!0),l.indexOf("g")!=-1&&(v=!0),Le("pcre")?i=i+"/"+l:i=i.replace(/\//g,"\\/")+"/"+l)),i)try{Ue(e,i,!0,!0)}catch{D(e,"Invalid regex: "+i);return}if(a=a||b.lastSubstituteReplacePart,a===void 0){D(e,"No previous substitute regular expression");return}var m=de(e),C=m.getQuery(),g=t.line!==void 0?t.line:e.getCursor().line,p=t.lineEnd||g;g==e.firstLine()&&p==e.lastLine()&&(p=1/0),u&&(g=p,p=g+u-1);var w=re(e,new o(g,0)),S=e.getSearchCursor(C,w);zr(e,d,v,g,p,S,C,a,t.callback)},startinsert:function(e,t){We(e,t.argString=="!"?"A":"i",{})},redo:f.commands.redo,undo:f.commands.undo,write:function(e){f.commands.save?f.commands.save(e):e.save&&e.save()},nohlsearch:function(e){at(e)},yank:function(e){var t=H(e.getCursor()),r=t.line,n=e.getLine(r);b.registerController.pushText("0","yank",n,!0,!0)},delete:function(e,t){var r=t.selectionLine,n=isNaN(t.selectionLineEnd)?r:t.selectionLineEnd;et.delete(e,{linewise:!0},[{anchor:new o(r,0),head:new o(n+1,0)}])},join:function(e,t){var r=t.selectionLine,n=isNaN(t.selectionLineEnd)?r:t.selectionLineEnd;e.setCursor(new o(r,0)),_e.joinLines(e,{repeat:n-r},e.state.vim)},delmarks:function(e,t){if(!t.argString||!tt(t.argString)){D(e,"Argument required");return}for(var r=e.state.vim,n=new f.StringStream(tt(t.argString));!n.eol();){n.eatSpace();var i=n.pos;if(!n.match(/[a-zA-Z]/,!1)){D(e,"Invalid argument: "+t.argString.substring(i));return}var a=n.next();if(n.match("-",!0)){if(!n.match(/[a-zA-Z]/,!1)){D(e,"Invalid argument: "+t.argString.substring(i));return}var s=a,l=n.next();if(s&&l&&ie(s)==ie(l)){var u=s.charCodeAt(0),d=l.charCodeAt(0);if(u>=d){D(e,"Invalid argument: "+t.argString.substring(i));return}for(var v=0;v<=d-u;v++){var m=String.fromCharCode(u+v);delete r.marks[m]}}else{D(e,"Invalid argument: "+s+"-");return}}else a&&delete r.marks[a]}}},ve=new qr;function zr(e,t,r,n,i,a,s,l,u){e.state.vim.exMode=!0;var d=!1,v,m,C;function g(){e.operation(function(){for(;!d;)p(),S();E()})}function p(){var A=e.getRange(a.from(),a.to()),_=A.replace(s,l),te=a.to().line;a.replace(_),m=a.to().line,i+=m-te,C=m<te}function w(){var A=v&&H(a.to()),_=a.findNext();return _&&!_[0]&&A&&ce(a.from(),A)&&(_=a.findNext()),_}function S(){for(;w()&&Jr(a.from(),n,i);)if(!(!r&&a.from().line==m&&!C)){e.scrollIntoView(a.from(),30),e.setSelection(a.from(),a.to()),v=a.from(),d=!1;return}d=!0}function E(A){if(A&&A(),e.focus(),v){e.setCursor(v);var _=e.state.vim;_.exMode=!1,_.lastHPos=_.lastHSPos=v.ch}u&&u()}function T(A,_,te){f.e_stop(A);var q=je(A);switch(q){case"y":p(),S();break;case"n":S();break;case"a":var Y=u;u=void 0,e.operation(g),u=Y;break;case"l":p();case"q":case"<Esc>":case"<C-c>":case"<C-[>":E(te);break}return d&&E(te),!0}if(S(),d){D(e,"No matches for "+s.source);return}if(!t){g(),u&&u();return}$e(e,{prefix:Ee("span","replace with ",Ee("strong",l)," (y/n/a/q/l)"),onKeyDown:T})}function Ae(e,t){var r=e.state.vim,n=b.macroModeState,i=b.registerController.getRegister("."),a=n.isPlaying,s=n.lastInsertModeChanges;a||(e.off("change",Wt),r.insertEnd&&r.insertEnd.clear(),r.insertEnd=void 0,f.off(e.getInputField(),"keydown",Ut)),!a&&r.insertModeRepeat>1&&(Qt(e,r,r.insertModeRepeat-1,!0),r.lastEditInputState.repeatOverride=r.insertModeRepeat),delete r.insertModeRepeat,r.insertMode=!1,t||e.setCursor(e.getCursor().line,e.getCursor().ch-1),e.setOption("keyMap","vim"),e.setOption("disableInput",!0),e.toggleOverwrite(!1),i.setText(s.changes.join("")),f.signal(e,"vim-mode-change",{mode:"normal"}),n.isRecording&&Yr(n)}function Vt(e){h.unshift(e)}function Gr(e,t,r,n,i){var a={keys:e,type:t};a[t]=r,a[t+"Args"]=n;for(var s in i)a[s]=i[s];Vt(a)}Ne("insertModeEscKeysTimeout",200,"number");function Xr(e,t,r,n){var i=b.registerController.getRegister(n);if(n==":"){i.keyBuffer[0]&&ve.processCommand(e,i.keyBuffer[0]),r.isPlaying=!1;return}var a=i.keyBuffer,s=0;r.isPlaying=!0,r.replaySearchQueries=i.searchQueries.slice(0);for(var l=0;l<a.length;l++)for(var u=a[l],d,v,m=/<(?:[CSMA]-)*\w+>|./gi;d=m.exec(u);)if(v=d[0],fe.handleKey(e,v,"macro"),t.insertMode){var C=i.insertModeChanges[s++].changes;b.macroModeState.lastInsertModeChanges.changes=C,qt(e,C,1),Ae(e)}r.isPlaying=!1}function Zr(e,t){if(!e.isPlaying){var r=e.latestRegister,n=b.registerController.getRegister(r);n&&n.pushText(t)}}function Yr(e){if(!e.isPlaying){var t=e.latestRegister,r=b.registerController.getRegister(t);r&&r.pushInsertModeChanges&&r.pushInsertModeChanges(e.lastInsertModeChanges)}}function en(e,t){if(!e.isPlaying){var r=e.latestRegister,n=b.registerController.getRegister(r);n&&n.pushSearchQuery&&n.pushSearchQuery(t)}}function Wt(e,t){var r=b.macroModeState,n=r.lastInsertModeChanges;if(!r.isPlaying)for(var i=e.state.vim;t;){if(n.expectCursorActivityForChange=!0,n.ignoreCount>1)n.ignoreCount--;else if(t.origin=="+input"||t.origin=="paste"||t.origin===void 0){var a=e.listSelections().length;a>1&&(n.ignoreCount=a);var s=t.text.join(`
`);if(n.maybeReset&&(n.changes=[],n.maybeReset=!1),s)if(e.state.overwrite&&!/\n/.test(s))n.changes.push([s]);else{if(s.length>1){var l=i&&i.insertEnd&&i.insertEnd.find(),u=e.getCursor();if(l&&l.line==u.line){var d=l.ch-u.ch;d>0&&d<s.length&&(n.changes.push([s,d]),s="")}}s&&n.changes.push(s)}}t=t.next}}function jt(e){var i;var t=e.state.vim;if(t.insertMode){var r=b.macroModeState;if(r.isPlaying)return;var n=r.lastInsertModeChanges;n.expectCursorActivityForChange?n.expectCursorActivityForChange=!1:(n.maybeReset=!0,t.insertEnd&&t.insertEnd.clear(),t.insertEnd=e.setBookmark(e.getCursor(),{insertLeft:!0}))}else(i=e.curOp)!=null&&i.isVimOp||$t(e,t)}function $t(e,t){var r=e.getCursor("anchor"),n=e.getCursor("head");if(t.visualMode&&!e.somethingSelected()?ye(e,!1):!t.visualMode&&!t.insertMode&&e.somethingSelected()&&(t.visualMode=!0,t.visualLine=!1,f.signal(e,"vim-mode-change",{mode:"visual"})),t.visualMode){var i=$(n,r)?0:-1,a=$(n,r)?-1:0;n=J(n,0,i),r=J(r,0,a),t.sel={anchor:r,head:n},be(e,t,"<",ae(n,r)),be(e,t,">",Te(n,r))}else t.insertMode||(t.lastHPos=e.getCursor().ch)}function st(e,t){this.keyName=e,this.key=t.key,this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.shiftKey=t.shiftKey}function Ut(e){var t=b.macroModeState,r=t.lastInsertModeChanges,n=f.keyName?f.keyName(e):e.key;n&&(n.indexOf("Delete")!=-1||n.indexOf("Backspace")!=-1)&&(r.maybeReset&&(r.changes=[],r.maybeReset=!1),r.changes.push(new st(n,e)))}function Qt(e,t,r,n){var i=b.macroModeState;i.isPlaying=!0;var a=t.lastEditActionCommand,s=t.inputState;function l(){a?Re.processAction(e,t,a):Re.evalInput(e,t)}function u(v){if(i.lastInsertModeChanges.changes.length>0){v=t.lastEditActionCommand?v:1;var m=i.lastInsertModeChanges;qt(e,m.changes,v)}}if(t.inputState=t.lastEditInputState,a&&a.interlaceInsertRepeat)for(var d=0;d<r;d++)l(),u(1);else n||l(),u(r);t.inputState=s,t.insertMode&&!n&&Ae(e),i.isPlaying=!1}function Jt(e,t){f.lookupKey(t,"vim-insert",function(n){return typeof n=="string"?f.commands[n](e):n(e),!0})}function qt(e,t,r){var n=e.getCursor("head"),i=b.macroModeState.lastInsertModeChanges.visualBlock;i&&(xt(e,n,i+1),r=e.listSelections().length,e.setCursor(n));for(var a=0;a<r;a++){i&&e.setCursor(J(n,a,0));for(var s=0;s<t.length;s++){var l=t[s];if(l instanceof st)Jt(e,l.keyName);else if(typeof l=="string")e.replaceSelection(l);else{var u=e.getCursor(),d=J(u,0,l[0].length-(l[1]||0));e.replaceRange(l[0],u,l[1]?u:d),e.setCursor(d)}}}i&&e.setCursor(J(n,0,1))}function lt(e){var t=new e.constructor;return Object.keys(e).forEach(function(r){if(r!="insertEnd"){var n=e[r];Array.isArray(n)?n=n.slice():n&&typeof n=="object"&&n.constructor!=Object&&(n=lt(n)),t[r]=n}}),e.sel&&(t.sel={head:e.sel.head&&H(e.sel.head),anchor:e.sel.anchor&&H(e.sel.anchor)}),t}function tn(e,t,r){var a=Pe(e),n=e,i=!1,a=fe.maybeInitVimState_(n),s=a.visualBlock||a.wasInVisualBlock,l=n.isInMultiSelectMode();if(a.wasInVisualBlock&&!l?a.wasInVisualBlock=!1:l&&a.visualBlock&&(a.wasInVisualBlock=!0),t=="<Esc>"&&!a.insertMode&&!a.visualMode&&l&&a.status=="<Esc>")X(n);else if(s||!l||n.inVirtualSelectionMode)i=fe.handleKey(n,t,r);else{var u=lt(a),d=a.inputState.changeQueueList||[];n.operation(function(){var m;n.curOp&&(n.curOp.isVimOp=!0);var v=0;n.forEachSelection(function(){n.state.vim.inputState.changeQueue=d[v];var C=n.getCursor("head"),g=n.getCursor("anchor"),p=$(C,g)?0:-1,w=$(C,g)?-1:0;C=J(C,0,p),g=J(g,0,w),n.state.vim.sel.head=C,n.state.vim.sel.anchor=g,i=fe.handleKey(n,t,r),n.virtualSelection&&(d[v]=n.state.vim.inputState.changeQueue,n.state.vim=lt(u)),v++}),(m=n.curOp)!=null&&m.cursorActivity&&!i&&(n.curOp.cursorActivity=!1),n.state.vim=a,a.inputState.changeQueueList=d,a.inputState.changeQueue=null},!0)}return i&&!a.visualMode&&!a.insert&&a.visualMode!=n.somethingSelected()&&$t(n,a),i}return vt(),fe}function oe(f,o){var c=o.ch,h=o.line+1;h<1&&(h=1,c=0),h>f.lines&&(h=f.lines,c=Number.MAX_VALUE);var y=f.line(h);return Math.min(y.from+Math.max(0,c),y.to)}function he(f,o){let c=f.lineAt(o);return{line:c.number-1,ch:o-c.from}}class ke{constructor(o,c){this.line=o,this.ch=c}}function Yt(f,o,c){if(f.addEventListener)f.addEventListener(o,c,!1);else{var h=f._handlers||(f._handlers={});h[o]=(h[o]||[]).concat(c)}}function er(f,o,c){if(f.removeEventListener)f.removeEventListener(o,c,!1);else{var h=f._handlers,y=h&&h[o];if(y){var k=y.indexOf(c);k>-1&&(h[o]=y.slice(0,k).concat(y.slice(k+1)))}}}function tr(f,o,...c){var h,y=(h=f._handlers)===null||h===void 0?void 0:h[o];if(y)for(var k=0;k<y.length;++k)y[k](...c)}function zt(f,...o){if(f)for(var c=0;c<f.length;++c)f[c](...o)}let ct;try{ct=new RegExp("[\\w\\p{Alphabetic}\\p{Number}_]","u")}catch{ct=/[\w]/}function qe(f,o){var c=f.cm6;if(!c.state.readOnly){var h="input.type.compose";if(f.curOp&&(f.curOp.lastChange||(h="input.type.compose.start")),o.annotations)try{o.annotations.some(function(y){y.value=="input"&&(y.value=h)})}catch(y){console.error(y)}else o.userEvent=h;return c.dispatch(o)}}function Gt(f,o){var c;f.curOp&&(f.curOp.$changeStart=void 0),(o?we.undo:we.redo)(f.cm6);let h=(c=f.curOp)===null||c===void 0?void 0:c.$changeStart;h!=null&&f.cm6.dispatch({selection:{anchor:h}})}var sn={};class R{constructor(o){this.state={},this.marks=Object.create(null),this.$mid=0,this.options={},this._handlers={},this.$lastChangeEndOffset=0,this.virtualSelection=null,this.cm6=o,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this)}openDialog(o,c,h){return un(this,o,c,h)}openNotification(o,c){return ln(this,o,c)}on(o,c){Yt(this,o,c)}off(o,c){er(this,o,c)}signal(o,c,h){tr(this,o,c,h)}indexFromPos(o){return oe(this.cm6.state.doc,o)}posFromIndex(o){return he(this.cm6.state.doc,o)}foldCode(o){let c=this.cm6,h=c.state.selection.ranges,y=this.cm6.state.doc,k=oe(y,o),x=G.EditorSelection.create([G.EditorSelection.range(k,k)],0).ranges;c.state.selection.ranges=x,Oe.foldCode(c),c.state.selection.ranges=h}firstLine(){return 0}lastLine(){return this.cm6.state.doc.lines-1}lineCount(){return this.cm6.state.doc.lines}setCursor(o,c){typeof o=="object"&&(c=o.ch,o=o.line);var h=oe(this.cm6.state.doc,{line:o,ch:c||0});this.cm6.dispatch({selection:{anchor:h}},{scrollIntoView:!this.curOp}),this.curOp&&!this.curOp.isVimOp&&this.onBeforeEndOperation()}getCursor(o){var c=this.cm6.state.selection.main,h=o=="head"||!o?c.head:o=="anchor"?c.anchor:o=="start"?c.from:o=="end"?c.to:null;if(h==null)throw new Error("Invalid cursor type");return this.posFromIndex(h)}listSelections(){var o=this.cm6.state.doc;return this.cm6.state.selection.ranges.map(c=>({anchor:he(o,c.anchor),head:he(o,c.head)}))}setSelections(o,c){var h=this.cm6.state.doc,y=o.map(k=>{var x=oe(h,k.head),M=oe(h,k.anchor);return x==M?G.EditorSelection.cursor(x,1):G.EditorSelection.range(M,x)});this.cm6.dispatch({selection:G.EditorSelection.create(y,c)})}setSelection(o,c,h){this.setSelections([{anchor:o,head:c}],0),h&&h.origin=="*mouse"&&this.onBeforeEndOperation()}getLine(o){var c=this.cm6.state.doc;return o<0||o>=c.lines?"":this.cm6.state.doc.line(o+1).text}getLineHandle(o){return this.$lineHandleChanges||(this.$lineHandleChanges=[]),{row:o,index:this.indexFromPos(new ke(o,0))}}getLineNumber(o){var c=this.$lineHandleChanges;if(!c)return null;for(var h=o.index,y=0;y<c.length;y++)if(h=c[y].changes.mapPos(h,1,G.MapMode.TrackAfter),h==null)return null;var k=this.posFromIndex(h);return k.ch==0?k.line:null}releaseLineHandles(){this.$lineHandleChanges=void 0}getRange(o,c){var h=this.cm6.state.doc;return this.cm6.state.sliceDoc(oe(h,o),oe(h,c))}replaceRange(o,c,h,y){h||(h=c);var k=this.cm6.state.doc,x=oe(k,c),M=oe(k,h);qe(this,{changes:{from:x,to:M,insert:o}})}replaceSelection(o){qe(this,this.cm6.state.replaceSelection(o))}replaceSelections(o){var c=this.cm6.state.selection.ranges,h=c.map((y,k)=>({from:y.from,to:y.to,insert:o[k]||""}));qe(this,{changes:h})}getSelection(){return this.getSelections().join(`
`)}getSelections(){var o=this.cm6;return o.state.selection.ranges.map(c=>o.state.sliceDoc(c.from,c.to))}somethingSelected(){return this.cm6.state.selection.ranges.some(o=>!o.empty)}getInputField(){return this.cm6.contentDOM}clipPos(o){var c=this.cm6.state.doc,h=o.ch,y=o.line+1;y<1&&(y=1,h=0),y>c.lines&&(y=c.lines,h=Number.MAX_VALUE);var k=c.line(y);return h=Math.min(Math.max(0,h),k.to-k.from),new ke(y-1,h)}getValue(){return this.cm6.state.doc.toString()}setValue(o){var c=this.cm6;return c.dispatch({changes:{from:0,to:c.state.doc.length,insert:o},selection:G.EditorSelection.range(0,0)})}focus(){return this.cm6.focus()}blur(){return this.cm6.contentDOM.blur()}defaultTextHeight(){return this.cm6.defaultLineHeight}findMatchingBracket(o,c){var h=this.cm6.state,y=oe(h.doc,o),k=Oe.matchBrackets(h,y+1,-1);return k&&k.end?{to:he(h.doc,k.end.from)}:(k=Oe.matchBrackets(h,y,1),k&&k.end?{to:he(h.doc,k.end.from)}:{to:void 0})}scanForBracket(o,c,h,y){return hn(this,o,c,h,y)}indentLine(o,c){c?this.indentMore():this.indentLess()}indentMore(){we.indentMore(this.cm6)}indentLess(){we.indentLess(this.cm6)}execCommand(o){if(o=="indentAuto")R.commands.indentAuto(this);else if(o=="goLineLeft")we.cursorLineBoundaryBackward(this.cm6);else if(o=="goLineRight"){we.cursorLineBoundaryForward(this.cm6);let c=this.cm6.state,h=c.selection.main.head;h<c.doc.length&&c.sliceDoc(h,h+1)!==`
`&&we.cursorCharBackward(this.cm6)}else console.log(o+" is not implemented")}setBookmark(o,c){var h=c!=null&&c.insertLeft?1:-1,y=this.indexFromPos(o),k=new pn(this,y,h);return k}addOverlay({query:o}){let c=new Je.SearchQuery({regexp:!0,search:o.source,caseSensitive:!/i/.test(o.flags)});if(c.valid){c.forVim=!0,this.cm6Query=c;let h=Je.setSearchQuery.of(c);return this.cm6.dispatch({effects:h}),c}}removeOverlay(o){if(!this.cm6Query)return;this.cm6Query.forVim=!1;let c=Je.setSearchQuery.of(this.cm6Query);this.cm6.dispatch({effects:c})}getSearchCursor(o,c){var h=this,y=null,k=null;c.ch==null&&(c.ch=Number.MAX_VALUE);var x=oe(h.cm6.state.doc,c),M=o.source.replace(/(\\.|{(?:\d+(?:,\d*)?|,\d+)})|[{}]/g,function(O,V){return V||"\\"+O});function L(O,V=0,P=O.length){return new Je.RegExpCursor(O,M,{ignoreCase:o.ignoreCase},V,P)}function K(O){var V=h.cm6.state.doc;if(O>V.length)return null;let P=L(V,O).next();return P.done?null:P.value}var F=1e4;function I(O,V){var P=h.cm6.state.doc;for(let U=1;;U++){let W=Math.max(O,V-U*F),le=L(P,W,V),ie=null;for(;!le.next().done;)ie=le.value;if(ie&&(W==O||ie.from>W+10))return ie;if(W==O)return null}}return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(O){var V=h.cm6.state.doc;if(O){let P=y?y.from==y.to?y.to-1:y.from:x;y=I(0,P)}else{let P=y?y.from==y.to?y.to+1:y.to:x;y=K(P)}return k=y&&{from:he(V,y.from),to:he(V,y.to),match:y.match},y&&y.match},from:function(){return k==null?void 0:k.from},to:function(){return k==null?void 0:k.to},replace:function(O){y&&(qe(h,{changes:{from:y.from,to:y.to,insert:O}}),y.to=y.from+O.length,k&&(k.to=he(h.cm6.state.doc,y.to)))}}}findPosV(o,c,h,y){let{cm6:k}=this;const x=k.state.doc;let M=h=="page"?k.dom.clientHeight:0;const L=oe(x,o);let K=G.EditorSelection.cursor(L,1,void 0,y),F=Math.round(Math.abs(c));for(let O=0;O<F;O++)h=="page"?K=k.moveVertically(K,c>0,M):h=="line"&&(K=k.moveVertically(K,c>0));let I=he(x,K.head);return(c<0&&K.head==0&&y!=0&&o.line==0&&o.ch!=0||c>0&&K.head==x.length&&I.ch!=y&&o.line==I.line)&&(I.hitSide=!0),I}charCoords(o,c){var h=this.cm6.contentDOM.getBoundingClientRect(),y=oe(this.cm6.state.doc,o),k=this.cm6.coordsAtPos(y),x=-h.top;return{left:((k==null?void 0:k.left)||0)-h.left,top:((k==null?void 0:k.top)||0)+x,bottom:((k==null?void 0:k.bottom)||0)+x}}coordsChar(o,c){var h=this.cm6.contentDOM.getBoundingClientRect(),y=this.cm6.posAtCoords({x:o.left+h.left,y:o.top+h.top})||0;return he(this.cm6.state.doc,y)}getScrollInfo(){var o=this.cm6.scrollDOM;return{left:o.scrollLeft,top:o.scrollTop,height:o.scrollHeight,width:o.scrollWidth,clientHeight:o.clientHeight,clientWidth:o.clientWidth}}scrollTo(o,c){o!=null&&(this.cm6.scrollDOM.scrollLeft=o),c!=null&&(this.cm6.scrollDOM.scrollTop=c)}scrollIntoView(o,c){if(o){var h=this.indexFromPos(o);this.cm6.dispatch({effects:se.EditorView.scrollIntoView(h)})}else this.cm6.dispatch({scrollIntoView:!0,userEvent:"scroll"})}getWrapperElement(){return this.cm6.dom}getMode(){return{name:this.getOption("mode")}}setSize(o,c){this.cm6.dom.style.width=o+4+"px",this.cm6.dom.style.height=c+"px",this.refresh()}refresh(){this.cm6.measure()}destroy(){this.removeOverlay()}getLastEditEnd(){return this.posFromIndex(this.$lastChangeEndOffset)}onChange(o){this.$lineHandleChanges&&this.$lineHandleChanges.push(o);for(let h in this.marks)this.marks[h].update(o.changes);this.virtualSelection&&(this.virtualSelection.ranges=this.virtualSelection.ranges.map(h=>h.map(o.changes)));var c=this.curOp=this.curOp||{};o.changes.iterChanges((h,y,k,x,M)=>{(c.$changeStart==null||c.$changeStart>k)&&(c.$changeStart=k),this.$lastChangeEndOffset=x;var L={text:M.toJSON()};c.lastChange?c.lastChange.next=c.lastChange=L:c.lastChange=c.change=L},!0),c.changeHandlers||(c.changeHandlers=this._handlers.change&&this._handlers.change.slice())}onSelectionChange(){var o=this.curOp=this.curOp||{};o.cursorActivityHandlers||(o.cursorActivityHandlers=this._handlers.cursorActivity&&this._handlers.cursorActivity.slice()),this.curOp.cursorActivity=!0}operation(o,c){this.curOp||(this.curOp={$d:0}),this.curOp.$d++;try{var h=o()}finally{this.curOp&&(this.curOp.$d--,this.curOp.$d||this.onBeforeEndOperation())}return h}onBeforeEndOperation(){var o=this.curOp,c=!1;o&&(o.change&&zt(o.changeHandlers,this,o.change),o&&o.cursorActivity&&(zt(o.cursorActivityHandlers,this,null),o.isVimOp&&(c=!0)),this.curOp=null),c&&this.scrollIntoView()}moveH(o,c){if(c=="char"){var h=this.getCursor();this.setCursor(h.line,h.ch+o)}}setOption(o,c){switch(o){case"keyMap":this.state.keyMap=c;break;case"textwidth":this.state.textwidth=c;break}}getOption(o){switch(o){case"firstLineNumber":return 1;case"tabSize":return this.cm6.state.tabSize||4;case"readOnly":return this.cm6.state.readOnly;case"indentWithTabs":return this.cm6.state.facet(Oe.indentUnit)=="	";case"indentUnit":return this.cm6.state.facet(Oe.indentUnit).length||2;case"textwidth":return this.state.textwidth;case"keyMap":return this.state.keyMap||"vim"}}toggleOverwrite(o){this.state.overwrite=o}getTokenTypeAt(o){var c,h=this.indexFromPos(o),y=Oe.ensureSyntaxTree(this.cm6.state,h),k=y==null?void 0:y.resolve(h),x=((c=k==null?void 0:k.type)===null||c===void 0?void 0:c.name)||"";return/comment/i.test(x)?"comment":/string/i.test(x)?"string":""}overWriteSelection(o){var c=this.cm6.state.doc,h=this.cm6.state.selection,y=h.ranges.map(k=>{if(k.empty){var x=k.to<c.length?c.sliceString(k.from,k.to+1):"";if(x&&!/\n/.test(x))return G.EditorSelection.range(k.from,k.to+1)}return k});this.cm6.dispatch({selection:G.EditorSelection.create(y,h.mainIndex)}),this.replaceSelection(o)}isInMultiSelectMode(){return this.cm6.state.selection.ranges.length>1}virtualSelectionMode(){return!!this.virtualSelection}forEachSelection(o){var c=this.cm6.state.selection;this.virtualSelection=G.EditorSelection.create(c.ranges,c.mainIndex);for(var h=0;h<this.virtualSelection.ranges.length;h++){var y=this.virtualSelection.ranges[h];y&&(this.cm6.dispatch({selection:G.EditorSelection.create([y])}),o(),this.virtualSelection.ranges[h]=this.cm6.state.selection.ranges[0])}this.cm6.dispatch({selection:this.virtualSelection}),this.virtualSelection=null}hardWrap(o){return gn(this,o)}}R.isMac=typeof navigator<"u"&&/Mac/.test(navigator.platform);R.Pos=ke;R.StringStream=Oe.StringStream;R.commands={cursorCharLeft:function(f){we.cursorCharLeft(f.cm6)},redo:function(f){Gt(f,!1)},undo:function(f){Gt(f,!0)},newlineAndIndent:function(f){we.insertNewlineAndIndent({state:f.cm6.state,dispatch:o=>qe(f,o)})},indentAuto:function(f){we.indentSelection(f.cm6)},newlineAndIndentContinueComment:void 0,save:void 0};R.isWordChar=function(f){return ct.test(f)};R.keys=sn;R.addClass=function(f,o){};R.rmClass=function(f,o){};R.e_preventDefault=function(f){f.preventDefault()};R.e_stop=function(f){var o,c;(o=f==null?void 0:f.stopPropagation)===null||o===void 0||o.call(f),(c=f==null?void 0:f.preventDefault)===null||c===void 0||c.call(f)};R.lookupKey=function(o,c,h){var y=R.keys[o];y&&h(y)};R.on=Yt;R.off=er;R.signal=tr;R.findMatchingTag=dn;R.findEnclosingTag=vn;R.keyName=void 0;function rr(f,o,c){var h=document.createElement("div");return h.appendChild(o),h}function nr(f,o){f.state.currentNotificationClose&&f.state.currentNotificationClose(),f.state.currentNotificationClose=o}function ln(f,o,c){nr(f,M);var h=rr(f,o,c&&c.bottom),y=!1,k,x=c&&typeof c.duration<"u"?c.duration:5e3;function M(){y||(y=!0,clearTimeout(k),h.remove(),ar(f,h))}return h.onclick=function(L){L.preventDefault(),M()},ir(f,h),x&&(k=setTimeout(M,x)),M}function ir(f,o){var c=f.state.dialog;f.state.dialog=o,o&&c!==o&&(c&&c.contains(document.activeElement)&&f.focus(),c&&c.parentElement?c.parentElement.replaceChild(o,c):c&&c.remove(),R.signal(f,"dialog"))}function ar(f,o){f.state.dialog==o&&(f.state.dialog=null,R.signal(f,"dialog"))}function un(f,o,c,h){h||(h={}),nr(f,void 0);var y=rr(f,o,h.bottom),k=!1;ir(f,y);function x(L){if(typeof L=="string")M.value=L;else{if(k)return;k=!0,ar(f,y),f.state.dialog||f.focus(),h.onClose&&h.onClose(y)}}var M=y.getElementsByTagName("input")[0];return M&&(h.value&&(M.value=h.value,h.selectValueOnOpen!==!1&&M.select()),h.onInput&&R.on(M,"input",function(L){h.onInput(L,M.value,x)}),h.onKeyUp&&R.on(M,"keyup",function(L){h.onKeyUp(L,M.value,x)}),R.on(M,"keydown",function(L){h&&h.onKeyDown&&h.onKeyDown(L,M.value,x)||(L.keyCode==13&&c(M.value),(L.keyCode==27||h.closeOnEnter!==!1&&L.keyCode==13)&&(M.blur(),R.e_stop(L),x()))}),h.closeOnBlur!==!1&&R.on(M,"blur",function(){setTimeout(function(){document.activeElement!==M&&x()})}),M.focus()),x}var fn={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function cn(f){return f&&f.bracketRegex||/[(){}[\]]/}function hn(f,o,c,h,y){for(var k=y&&y.maxScanLineLength||1e4,x=y&&y.maxScanLines||1e3,M=[],L=cn(y),K=c>0?Math.min(o.line+x,f.lastLine()+1):Math.max(f.firstLine()-1,o.line-x),F=o.line;F!=K;F+=c){var I=f.getLine(F);if(I){var O=c>0?0:I.length-1,V=c>0?I.length:-1;if(!(I.length>k))for(F==o.line&&(O=o.ch-(c<0?1:0));O!=V;O+=c){var P=I.charAt(O);if(L.test(P)){var U=fn[P];if(U&&U.charAt(1)==">"==c>0)M.push(P);else if(M.length)M.pop();else return{pos:new ke(F,O),ch:P}}}}}return F-c==(c>0?f.lastLine():f.firstLine())?!1:null}function dn(f,o){}function vn(f,o){var c,h,y=f.cm6.state,k=f.indexFromPos(o);if(k<y.doc.length){var x=y.sliceDoc(k,k+1);x=="<"&&k++}for(var M=Oe.ensureSyntaxTree(y,k),L=(M==null?void 0:M.resolve(k))||null;L;){if(((c=L.firstChild)===null||c===void 0?void 0:c.type.name)=="OpenTag"&&((h=L.lastChild)===null||h===void 0?void 0:h.type.name)=="CloseTag")return{open:Xt(y.doc,L.firstChild),close:Xt(y.doc,L.lastChild)};L=L.parent}}function Xt(f,o){return{from:he(f,o.from),to:he(f,o.to)}}class pn{constructor(o,c,h){this.cm=o,this.id=o.$mid++,this.offset=c,this.assoc=h,o.marks[this.id]=this}clear(){delete this.cm.marks[this.id]}find(){return this.offset==null?null:this.cm.posFromIndex(this.offset)}update(o){this.offset!=null&&(this.offset=o.mapPos(this.offset,this.assoc,G.MapMode.TrackDel))}}function gn(f,o){for(var c,h=o.column||f.getOption("textwidth")||80,y=o.allowMerge!=!1,k=Math.min(o.from,o.to),x=Math.max(o.from,o.to);k<=x;){var M=f.getLine(k);if(M.length>h){var L=P(M,h,5);if(L){var K=(c=/^\s*/.exec(M))===null||c===void 0?void 0:c[0];f.replaceRange(`
`+K,new ke(k,L.start),new ke(k,L.end))}x++}else if(y&&/\S/.test(M)&&k!=x){var F=f.getLine(k+1);if(F&&/\S/.test(F)){var I=M.replace(/\s+$/,""),O=F.replace(/^\s+/,""),V=I+" "+O,L=P(V,h,5);L&&L.start>I.length||V.length<h?(f.replaceRange(" ",new ke(k,I.length),new ke(k+1,F.length-O.length)),k--,x--):I.length<M.length&&f.replaceRange("",new ke(k,I.length),new ke(k,M.length))}}k++}return k;function P(U,W,le){if(!(U.length<W)){var ie=U.slice(0,W),Be=U.slice(W),Se=/^(?:(\s+)|(\S+)(\s+))/.exec(Be),ue=/(?:(\s+)|(\s+)(\S+))$/.exec(ie),j=0,pe=0;if(ue&&!ue[2]&&(j=W-ue[1].length,pe=W),Se&&!Se[2]&&(j||(j=W),pe=W+Se[1].length),j)return{start:j,end:pe};if(ue&&ue[2]&&ue.index>le)return{start:ue.index,end:ue.index+ue[2].length};if(Se&&Se[2])return j=W+Se[2].length,{start:j,end:j+Se[3].length}}}}let ht=an.getDrawSelectionConfig||function(){let f={cursorBlinkRate:1200};return function(){return f}}();class yn{constructor(o,c,h,y,k,x,M,L,K,F){this.left=o,this.top=c,this.height=h,this.fontFamily=y,this.fontSize=k,this.fontWeight=x,this.color=M,this.className=L,this.letter=K,this.partial=F}draw(){let o=document.createElement("div");return o.className=this.className,this.adjust(o),o}adjust(o){o.style.left=this.left+"px",o.style.top=this.top+"px",o.style.height=this.height+"px",o.style.lineHeight=this.height+"px",o.style.fontFamily=this.fontFamily,o.style.fontSize=this.fontSize,o.style.fontWeight=this.fontWeight,o.style.color=this.partial?"transparent":this.color,o.className=this.className,o.textContent=this.letter}eq(o){return this.left==o.left&&this.top==o.top&&this.height==o.height&&this.fontFamily==o.fontFamily&&this.fontSize==o.fontSize&&this.fontWeight==o.fontWeight&&this.color==o.color&&this.className==o.className&&this.letter==o.letter}}class mn{constructor(o,c){this.view=o,this.rangePieces=[],this.cursors=[],this.cm=c,this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.cursorLayer=o.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer cm-vimCursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),o.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){let c=ht(this.cm.cm6.state).cursorBlinkRate;this.cursorLayer.style.animationDuration=c+"ms"}update(o){(o.selectionSet||o.geometryChanged||o.viewportChanged)&&(this.view.requestMeasure(this.measureReq),this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink"),Cn(o)&&this.setBlinkRate()}scheduleRedraw(){this.view.requestMeasure(this.measureReq)}readPos(){let{state:o}=this.view,c=[];for(let h of o.selection.ranges){let y=h==o.selection.main,k=xn(this.cm,this.view,h,y);k&&c.push(k)}return{cursors:c}}drawSel({cursors:o}){if(o.length!=this.cursors.length||o.some((c,h)=>!c.eq(this.cursors[h]))){let c=this.cursorLayer.children;if(c.length!==o.length){this.cursorLayer.textContent="";for(const h of o)this.cursorLayer.appendChild(h.draw())}else o.forEach((h,y)=>h.adjust(c[y]));this.cursors=o}}destroy(){this.cursorLayer.remove()}}function Cn(f){return ht(f.startState)!=ht(f.state)}const kn={".cm-vimMode .cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-fat-cursor":{position:"absolute",background:"#ff9696",border:"none",whiteSpace:"pre"},"&:not(.cm-focused) .cm-fat-cursor":{background:"none",outline:"solid 1px #ff9696",color:"transparent !important"}},wn=G.Prec.highest(se.EditorView.theme(kn));function Sn(f){let o=f.scrollDOM.getBoundingClientRect();return{left:(f.textDirection==se.Direction.LTR?o.left:o.right-f.scrollDOM.clientWidth)-f.scrollDOM.scrollLeft,top:o.top-f.scrollDOM.scrollTop}}function xn(f,o,c,h){var y,k;let x=c.head,M=!1,L=1,K=f.state.vim;if(K&&(!K.insertMode||f.state.overwrite)){if(M=!0,K.visualBlock&&!h)return null;c.anchor<c.head&&x--,f.state.overwrite?L=.2:K.status&&(L=.5)}if(M){let I=x<o.state.doc.length&&o.state.sliceDoc(x,x+1);I&&/[\uDC00-\uDFFF]/.test(I)&&x>1&&(x--,I=o.state.sliceDoc(x,x+1));let O=o.coordsAtPos(x,1);if(!O)return null;let V=Sn(o),P=o.domAtPos(x),U=P?P.node:o.contentDOM;for(;P&&P.node instanceof HTMLElement;)U=P.node,P={node:P.node.childNodes[P.offset],offset:0};if(!(U instanceof HTMLElement)){if(!U.parentNode)return null;U=U.parentNode}let W=getComputedStyle(U),le=O.left,ie=(k=(y=o).coordsForChar)===null||k===void 0?void 0:k.call(y,x);if(ie&&(le=ie.left),!I||I==`
`||I=="\r")I=" ";else if(I=="	"){I=" ";var F=o.coordsAtPos(x+1,-1);F&&(le=F.left-(F.left-O.left)/parseInt(W.tabSize))}else/[\uD800-\uDBFF]/.test(I)&&x<o.state.doc.length-1&&(I+=o.state.sliceDoc(x+1,x+2));let Be=O.bottom-O.top;return new yn(le-V.left,O.top-V.top+Be*(1-L),Be*L,W.fontFamily,W.fontSize,W.fontWeight,W.color,h?"cm-fat-cursor cm-cursor-primary":"cm-fat-cursor cm-cursor-secondary",I,L!=1)}else return null}var Mn=typeof navigator<"u"&&/linux/i.test(navigator.platform)&&/ Gecko\/\d+/.exec(navigator.userAgent);const Ie=on(R),bn=250,Ln=se.EditorView.baseTheme({".cm-vimMode .cm-cursorLayer:not(.cm-vimCursorLayer)":{display:"none"},".cm-vim-panel":{padding:"0px 10px",fontFamily:"monospace",minHeight:"1.3em"},".cm-vim-panel input":{border:"none",outline:"none",backgroundColor:"inherit"},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"}}),Tn=se.ViewPlugin.fromClass(class{constructor(f){this.status="",this.query=null,this.decorations=se.Decoration.none,this.waitForCopy=!1,this.lastKeydown="",this.useNextTextInput=!1,this.compositionText="",this.view=f;const o=this.cm=new R(f);Ie.enterVimMode(this.cm),this.view.cm=this.cm,this.cm.state.vimPlugin=this,this.blockCursor=new mn(f,o),this.updateClass(),this.cm.on("vim-command-done",()=>{o.state.vim&&(o.state.vim.status=""),this.blockCursor.scheduleRedraw(),this.updateStatus()}),this.cm.on("vim-mode-change",c=>{o.state.vim&&(o.state.vim.mode=c.mode,c.subMode&&(o.state.vim.mode+=" block"),o.state.vim.status="",this.blockCursor.scheduleRedraw(),this.updateClass(),this.updateStatus())}),this.cm.on("dialog",()=>{this.cm.state.statusbar?this.updateStatus():f.dispatch({effects:or.of(!!this.cm.state.dialog)})}),this.dom=document.createElement("span"),this.dom.style.cssText="position: absolute; right: 10px; top: 1px",this.statusButton=document.createElement("span"),this.statusButton.onclick=c=>{Ie.handleKey(this.cm,"<Esc>","user"),this.cm.focus()},this.statusButton.style.cssText="cursor: pointer"}update(f){var o;if((f.viewportChanged||f.docChanged)&&this.query&&this.highlight(this.query),f.docChanged&&this.cm.onChange(f),f.selectionSet&&this.cm.onSelectionChange(),f.viewportChanged,this.cm.curOp&&!this.cm.curOp.isVimOp&&this.cm.onBeforeEndOperation(),f.transactions){for(let c of f.transactions)for(let h of c.effects)if(h.is(Je.setSearchQuery))if(!((o=h.value)===null||o===void 0?void 0:o.forVim))this.highlight(null);else{let k=h.value.create();this.highlight(k)}}this.blockCursor.update(f)}updateClass(){const f=this.cm.state;!f.vim||f.vim.insertMode&&!f.overwrite?this.view.scrollDOM.classList.remove("cm-vimMode"):this.view.scrollDOM.classList.add("cm-vimMode")}updateStatus(){let f=this.cm.state.statusbar,o=this.cm.state.vim;if(!f||!o)return;let c=this.cm.state.dialog;if(c)c.parentElement!=f&&(f.textContent="",f.appendChild(c));else{f.textContent="";var h=(o.mode||"normal").toUpperCase();o.insertModeReturn&&(h+="(C-O)"),this.statusButton.textContent=`--${h}--`,f.appendChild(this.statusButton)}this.dom.textContent=o.status,f.appendChild(this.dom)}destroy(){Ie.leaveVimMode(this.cm),this.updateClass(),this.blockCursor.destroy(),delete this.view.cm}highlight(f){if(this.query=f,!f)return this.decorations=se.Decoration.none;let{view:o}=this,c=new G.RangeSetBuilder;for(let h=0,y=o.visibleRanges,k=y.length;h<k;h++){let{from:x,to:M}=y[h];for(;h<k-1&&M>y[h+1].from-2*bn;)M=y[++h].to;f.highlight(o.state,x,M,(L,K)=>{c.add(L,K,An)})}return this.decorations=c.finish()}handleKey(f,o){const c=this.cm;let h=c.state.vim;if(!h)return;const y=Ie.vimKeyFromEvent(f,h);if(R.signal(this.cm,"inputEvent",{type:"handleKey",key:y}),!y)return;if(y=="<Esc>"&&!h.insertMode&&!h.visualMode&&this.query){const M=h.searchState_;M&&(c.removeOverlay(M.getOverlay()),M.setOverlay(null))}if(y==="<C-c>"&&!R.isMac&&c.somethingSelected())return this.waitForCopy=!0,!0;h.status=(h.status||"")+y;let x=Ie.multiSelectHandleKey(c,y,"user");return h=Ie.maybeInitVimState_(c),!x&&h.insertMode&&c.state.overwrite&&(f.key&&f.key.length==1&&!/\n/.test(f.key)?(x=!0,c.overWriteSelection(f.key)):f.key=="Backspace"&&(x=!0,R.commands.cursorCharLeft(c))),x&&(R.signal(this.cm,"vim-keypress",y),f.preventDefault(),f.stopPropagation(),this.blockCursor.scheduleRedraw()),this.updateStatus(),!!x}},{eventHandlers:{copy:function(f,o){this.waitForCopy&&(this.waitForCopy=!1,Promise.resolve().then(()=>{var c=this.cm,h=c.state.vim;h&&(h.insertMode?c.setSelection(c.getCursor(),c.getCursor()):c.operation(()=>{c.curOp&&(c.curOp.isVimOp=!0),Ie.handleKey(c,"<Esc>","user")}))}))},compositionstart:function(f,o){this.useNextTextInput=!0,R.signal(this.cm,"inputEvent",f)},compositionupdate:function(f,o){R.signal(this.cm,"inputEvent",f)},compositionend:function(f,o){R.signal(this.cm,"inputEvent",f)},keypress:function(f,o){R.signal(this.cm,"inputEvent",f),this.lastKeydown=="Dead"&&this.handleKey(f,o)},keydown:function(f,o){R.signal(this.cm,"inputEvent",f),this.lastKeydown=f.key,this.lastKeydown=="Unidentified"||this.lastKeydown=="Process"||this.lastKeydown=="Dead"?this.useNextTextInput=!0:(this.useNextTextInput=!1,this.handleKey(f,o))}},provide:()=>[se.EditorView.inputHandler.of((f,o,c,h)=>{var y,k,x=Nn(f);if(!x)return!1;var M=(y=x.state)===null||y===void 0?void 0:y.vim,L=x.state.vimPlugin;if(M&&!M.insertMode&&!(!((k=x.curOp)===null||k===void 0)&&k.isVimOp)){if(h==="\0\0")return!0;if(R.signal(x,"inputEvent",{type:"text",text:h,from:o,to:c}),h.length==1&&L.useNextTextInput){if(M.expectLiteralNext&&f.composing)return L.compositionText=h,!1;if(L.compositionText){var K=L.compositionText;L.compositionText="";var F=f.state.selection.main.head,I=f.state.sliceDoc(F-K.length,F);if(K===I){var O=x.getCursor();x.replaceRange("",x.posFromIndex(F-K.length),O)}}return L.handleKey({key:h,preventDefault:()=>{},stopPropagation:()=>{}}),En(f),!0}}return!1})],decorations:f=>f.decorations});function En(f){var o=f.scrollDOM.parentElement;if(o){if(Mn){f.contentDOM.textContent="\0\0",f.contentDOM.dispatchEvent(new CustomEvent("compositionend"));return}var c=f.scrollDOM.nextSibling,h=window.getSelection(),y=h&&{anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset};f.scrollDOM.remove(),o.insertBefore(f.scrollDOM,c);try{y&&h&&(h.setPosition(y.anchorNode,y.anchorOffset),y.focusNode&&h.extend(y.focusNode,y.focusOffset))}catch(k){console.error(k)}f.focus(),f.contentDOM.dispatchEvent(new CustomEvent("compositionend"))}}const An=se.Decoration.mark({class:"cm-searchMatch"}),or=G.StateEffect.define(),On=G.StateField.define({create:()=>!1,update(f,o){for(let c of o.effects)c.is(or)&&(f=c.value);return f},provide:f=>se.showPanel.from(f,o=>o?Rn:null)});function Rn(f){let o=document.createElement("div");o.className="cm-vim-panel";let c=f.cm;return c.state.dialog&&o.appendChild(c.state.dialog),{top:!1,dom:o}}function In(f){let o=document.createElement("div");o.className="cm-vim-panel";let c=f.cm;return c.state.statusbar=o,c.state.vimPlugin.updateStatus(),{dom:o}}function Bn(f={}){return[Ln,Tn,wn,f.status?se.showPanel.of(In):On]}function Nn(f){return f.cm||null}const Pn=se.EditorView.baseTheme({".cm-vim-panel":{paddingTop:"3px",paddingBottom:"3px"},".cm-vim-panel *":{fontFamily:"monospace",fontSize:"14px"}});Zt.MarkEdit.addExtension([Pn,G.Prec.highest(Bn({status:!0}))]);Zt.MarkEdit.onEditorReady(({dom:f})=>{const o=f.querySelector(".cm-panels-bottom");if(o===null)return;new MutationObserver(()=>{const h=Array.from(o.querySelectorAll("span")).find(y=>y.style.top==="1px");h&&(h.style.display="none")}).observe(o,{attributes:!0,childList:!0,subtree:!0})});
